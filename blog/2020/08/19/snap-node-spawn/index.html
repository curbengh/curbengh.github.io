<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Snap-installed Node.js cannot spawn() a Node.js app | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2020/08/19/snap-node-spawn/"><meta name="description" content="spawn()ing node binary itself also doesn&#39;t work"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="javascript"><meta property="article:tag" content="node.js"><meta property="og:type" content="article"><meta property="og:title" content="Snap-installed Node.js cannot spawn() a Node.js app"><meta property="og:url" content="https://mdleom.com/blog/2020/08/19/snap-node-spawn/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="spawn()ing node binary itself also doesn&#39;t work"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2020/08/19/snap-node-spawn/"><meta property="article:published_time" content="2020-08-19T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-snap-node-spawn" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Snap-installed Node.js cannot spawn() a Node.js app <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">spawn()ing node binary itself also doesn't work</p><div class="e-content article-entry" itemprop="articleBody"><p>There is an issue with <a href="https://github.com/nodesource/distributions#snap" rel="noopener external nofollow noreferrer">Snap-installed</a> Node.js that has been plaguing me for quite some time. I can <a href="https://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options" rel="noopener external nofollow noreferrer"><code>child_process.spawn()</code></a> to execute a system binary (<code>cat</code>, <code>ls</code>, etc) but not Node.js app binaries (like <code>npm</code>)</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)
<span class="hljs-keyword">const</span> npm = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">&#x27;npm&#x27;</span>, [<span class="hljs-string">&#x27;--version&#x27;</span>])

npm.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`stdout: <span class="hljs-subst">$&#123;data&#125;</span>`</span>)
&#125;)

npm.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`stderr: <span class="hljs-subst">$&#123;data&#125;</span>`</span>)
&#125;)

npm.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;close&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> &#123;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`child process exited with code <span class="hljs-subst">$&#123;code&#125;</span>`</span>)
&#125;)</code><button class="copy-button">Copy</button></pre><p>In above example, <code>spawn()</code> simply went straight to the <code>close</code> event; this issue also affects <code>node</code> binary (<code>spawn(&#39;node&#39;, [&#39;--version&#39;]</code>). Initially, I faulted Solus for having outdated version of snapd and moved one.</p><p>Recently, I tried to benchmark <a href="https://github.com/hexojs/hexo-renderer-marked/pull/159" rel="noopener external nofollow noreferrer">hexojs&#x2F;hexo-renderer-marked#159</a> using <a href="https://github.com/hexojs/hexo/blob/3a56d29e59598dd14c5b62efb3edd16b43944c5e/test/benchmark.js" rel="noopener external nofollow noreferrer">benchmark.js</a> currently used by Hexo to run regression testing. Since benchmark.js heavily utilise <code>spawn()</code>, so I could not run the benchmark on my Solus. Then, I tried again on a Ubuntu 20.04 VM and I got the same error message. By then, I realised it wasn’t Solus’ fault. Since Node.js was also installed via Snap (Ubuntu’s apt repo is still hosting v10) in that VM, the issue could be due to Snap with its additional confinement. I reinstalled Node.js using <a href="https://github.com/jasongin/nvs" rel="noopener external nofollow noreferrer">nvs</a> and then <code>spawn()</code> worked as expected.</p><p>This issue had been reported previously to NodeSource (maintainer of Node.js’s snap) in <a href="https://github.com/nodesource/distributions/issues/843" rel="noopener external nofollow noreferrer">nodesource&#x2F;distributions#843</a>, but unfortunately there was no interest in fixing it.</p></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2020-08-19T00:00:00.000Z" itemprop="datePublished">19 <a href="/blog/2020/08/" title="See August 2020's posts">Aug</a> <a href="/blog/2020/" title="See 2020's posts">2020</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/" rel="tag">Node.js</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/snap-node-spawn.md" rel="noopener external nofollow noreferrer">snap-node-spawn.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2020/08/30/override-smartypants-marked/"><div class="article-nav-title">Override smartypants in marked.js renderer</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2020/07/31/dedup-array-object-javascript/"><div class="article-nav-title">Remove duplicate objects in an array - JavaScript</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>