<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Block phishing websites with phishing-filter | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2020/07/07/phishing-filter/"><meta name="description" content="Many formats available"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="security"><meta property="og:type" content="article"><meta property="og:title" content="Block phishing websites with phishing-filter"><meta property="og:url" content="https://mdleom.com/blog/2020/07/07/phishing-filter/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="Many formats available"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2020/07/07/phishing-filter/"><meta property="article:published_time" content="2020-07-07T00:00:00.000Z"><meta property="article:modified_time" content="2020-07-11T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-phishing-filter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Block phishing websites with phishing-filter <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">Many formats available</p><div class="e-content article-entry" itemprop="articleBody"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#phishing-filter"><span class="toc-text">phishing-filter</span></a></li></ol><blockquote><p>Skip to <a href="#phishing-filter">phishing-filter</a> section</p></blockquote><p>Recently I switched Firefox’s Android app from Preview Nightly to Nightly after the former has been <a href="https://old.reddit.com/r/Android/comments/hk37jl/firefox_preview_has_been_merged_into_firefox/" rel="noopener external nofollow noreferrer">deprecated</a>. The switch entailed migrating the configurations; a config I need to migrate over is DNS-over-HTTPS (DoH). I verified the Quad9’s DoH address through its <a href="https://www.quad9.net/doh-quad9-dns-servers/" rel="noopener external nofollow noreferrer">instruction page</a> (tips: you can use “<a href="https://9.9.9.9/dns-query" rel="noopener external nofollow noreferrer">https://9.9.9.9/dns-query</a>“ instead of “<a href="https://dns.quad9.net/dns-query" rel="noopener external nofollow noreferrer">https://dns.quad9.net/dns-query</a>“ so that a browser doesn’t need to query the IP behind dns.quad9.net). I also checked out its <a href="https://quad9.net/dns-blocking-effectiveness-recent-independent-tests/" rel="noopener external nofollow noreferrer">recent article</a> that mentioned it blocks more malicious and phishing websites (via DNS-blocking) compared to other well-known DNS service–like Cloudflare and OpenDNS–according to an <a href="https://forums.lawrencesystems.com/t/dns-malware-filtering-compared-quad9-vs-cloudflare-vs-dns-filter-vs-opendns-cisco-umbrella/5072" rel="noopener external nofollow noreferrer">independent test</a>. The test was measured based on <a href="https://isc.sans.edu/suspicious_domains.html" rel="noopener external nofollow noreferrer">DShield.org Suspicious Domain List</a>.</p><p>(Edit) DShield.org dataset <a href="https://web.archive.org/web/20200528232041/https://isc.sans.edu/suspicious_domains.html" rel="noopener external nofollow noreferrer">previously</a> did not sourced from <a href="https://www.phishtank.com/" rel="noopener external nofollow noreferrer">PhishTank</a> and <a href="https://urlhaus.abuse.ch/" rel="noopener external nofollow noreferrer">URLhaus</a> datasets and were not actually used in that DNS test. DShield later <a href="https://web.archive.org/web/20200612030447/https://isc.sans.edu/suspicious_domains.html" rel="noopener external nofollow noreferrer">switched</a> after it found out the previous dataset was outdated. In light of this discovery, I conduct a DNS filtering test using datasets sourced from URLhaus and PhishTank, refer to <a href="/blog/2020/07/11/dns-filtering/" title="Comparing malware-blocking DNS providers using URLhaus and PhishTank">this post</a> for result.</p><p>I was intrigued by the DShield list as I created a blocklist (<a href="https://gitlab.com/curben/urlhaus-filter" rel="noopener external nofollow noreferrer">urlhaus-filter</a>) that is also based on URLhaus. I then checked out its another source, the PhishTank list. PhishTank operates similarly to URLhaus, the links are user-submitted. User can vote on submitted links (of other users’) are indeed phishing websites. The database is available in <a href="https://www.phishtank.com/developer_info.php" rel="noopener external nofollow noreferrer">various formats</a> including CSV. This seemed ideal to be processed into a blocklist, just like what I did in urlhaus-filter. To avoid duplicate effort, I did a search on FilterLists and there is a domain-based blocklist (“<a href="https://filterlists.com/lists/phishing-bad-sites" rel="noopener external nofollow noreferrer">Phishing Bad Sites</a>“) that is based on PhishTank.</p><p>Domain-based blocklist is created by stripping out the path of the original links, leaving the domain only (e.g. <code>www.example.com</code><del><code>/foo-page</code></del>). This blocks the whole website, instead of specific webpages; it also significantly reduces the file size, not just from the path stripping, but also de-duplication of domains. However, one thing I learned from urlhaus-filter is that many malicious links are also hosted on popular domains, like Google Docs and Dropbox; such is the fate of file-hosting service, it will inadvertently be abused to host malicious content. To avoid blocking those popular services, I utilise <a href="https://s3-us-west-1.amazonaws.com/umbrella-static/index.html" rel="noopener external nofollow noreferrer">Umbrella Popularity List</a> and <a href="https://tranco-list.eu/" rel="noopener external nofollow noreferrer">Tranco List</a> to remove popular domains from urlhaus-filter and minimise false positive. Since uBlock Origin (uBO) supports blocking webpages via static filter (e.g. <code>||example.com/foo-page$all</code>), malicious webpages (of popular domains) are still blocked in the <a href="https://gitlab.com/curben/urlhaus-filter#url-based" rel="noopener external nofollow noreferrer">uBO-specific filter</a>.</p><p>I ran a quick check on “Phishing Bad Sites” filter:</p><pre><code class="hljs plaintext">$ grep -F &#x27;google&#x27; 2020-07-07-phishing.bad.sites.conf</code><button class="copy-button">Copy</button></pre><p>The search result included Google Drive and Google Play. Hence, I find it necessary to create a new PhishTank-based filter, with minimal false positives and available in various formats (other than uBO). Another reason is that despite PhishTank being operated by OpenDNS, it <a href="https://www.phishtank.com/faq.php#whyisasitemarkedbyph" rel="noopener external nofollow noreferrer">does not</a> block all of the verified phishing websites.</p><h2 id="phishing-filter">phishing-filter <a href="#phishing-filter" class="headerlink" title="phishing-filter">§</a></h2><p>I presents <a href="https://gitlab.com/curben/phishing-filter" rel="noopener external nofollow noreferrer">phishing-filter</a>, a blocklist to restrict &gt;14K phishing websites. <a href="https://github.com/gorhill/uBlock" rel="noopener external nofollow noreferrer">uBlock Origin</a> (uBO) users can import <a href="https://gitlab.com/curben/phishing-filter/raw/master/dist/phishing-filter.txt" rel="noopener external nofollow noreferrer">phishing-filter.txt</a> to install the filter. Other formats includes domain-based, hosts-based, dnsmasq, bind and unbound, refer to the repository for installation guide. The blocklist utilises similar approach as urlhaus-filter to exclude popular domains. Phishing links found in popular domains are still included in the “phishing-filter.txt”, hence I recommend to use uBO for best result.</p><p>The workflow is largely similar to what I did in urlhaus-filter, so I don’t have to reinvent the wheel here. I did take the opportunity to improve the repository’s folder structure, which I find a bit messy in urlhaus-filter. urlhaus-filter’s folder structure is still retained as is because changing it would induce breaking change. In phishing-filter, all generated filters are put in <code>dist/</code> folder, taking a page from Javascript&#x2F;NPM libraries. All scripts are in <code>src/</code> folder and <code>utils</code> folder contains <a href="https://github.com/dbro/csvquote" rel="noopener external nofollow noreferrer">csvquote</a> binaries.</p><p>csvquote is a workaround for the use of <em>optional</em> quote in PhishTank database. A URL is quoted only when there is a comma.</p><pre><code class="hljs plaintext">1,http://example-phishing.com/lorem,...
2,&quot;http://example-phishing.net/ipsum,dolor&quot;,...</code><button class="copy-button">Copy</button></pre><p>This makes <code>cut</code> having incorrect result, the comma in the link is trimmed off,</p><pre><code class="hljs plaintext">$ cat phishtank.csv | cut -f 2 -d &quot;,&quot;
http://example-phishing.com/lorem
&quot;https://example.phishing.net/ipsum</code><button class="copy-button">Copy</button></pre><p>csvquote works by escaping the comma(s) in the column and then un-escape back.</p><pre><code class="hljs plaintext">$ cat phishtank.csv | csvquote | cut -f 2 -d &quot;,&quot; | csvquote -u
http://example-phishing.com/lorem
&quot;https://example.phishing.net/ipsum,ipsum&quot;</code><button class="copy-button">Copy</button></pre><p>I then remove the quotes with <code>sed &#39;s/&quot;//g&#39;</code>. It will be more convenient if <em>all</em> URLs are quoted–just like URLhaus.csv–I can simply use <code>cut -f 2 -d &#39;&quot;&#39;</code>. I know I’m not supposed to use <code>cut</code> to process csv, but there is no csv-processing command line tools available in Alpine Linux official packages.</p><p>Before I stumbled upon csvquote, I also considered <a href="https://github.com/BurntSushi/xsv" rel="noopener external nofollow noreferrer">xsv</a> and <a href="https://github.com/DavyLandman/csvtools" rel="noopener external nofollow noreferrer">csvtools</a>. xsv is written in Rust and can be installed via Cargo package manager, which is available in Alpine Linux. I couldn’t compile csvtools under Alpine because it’s not compatible with musl. Ultimately, I chose csvquote due to simplicity, minimal size and being compatible with both glibc and musl. Speaking of glibc and musl, the binaries are incompatible with each other; I couldn’t run glibc-compiled csvquote on Alpine (musl-based), neither did musl-compiled binary on Ubuntu. I utilise a musl detection script that can adjust the binary choice automatically.</p><pre><div class="caption"><span>script.sh</span><a href="https://stackoverflow.com/a/60471114" rel="noopener external nofollow noreferrer">Source</a></div><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span>

LIBC=<span class="hljs-string">&quot;<span class="hljs-subst">$(ldd /bin/ls | grep &#x27;musl&#x27; || [ $? = 1 ])</span>&quot;</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$LIBC</span>&quot;</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">rm</span> -f <span class="hljs-string">&quot;/tmp/musl.log&quot;</span>
  <span class="hljs-comment"># Not Musl</span>
  CSVQUOTE=<span class="hljs-string">&quot;../utils/csvquote-bin-glibc&quot;</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-comment"># Musl</span>
  CSVQUOTE=<span class="hljs-string">&quot;../utils/csvquote-bin-musl&quot;</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">cat</span> <span class="hljs-string">&quot;phishtank.csv&quot;</span> | \
<span class="hljs-string">&quot;./<span class="hljs-variable">$CSVQUOTE</span>&quot;</span> | \
<span class="hljs-built_in">cut</span> -f 2 -d <span class="hljs-string">&quot;,&quot;</span> | \
<span class="hljs-string">&quot;./<span class="hljs-variable">$CSVQUOTE</span>&quot;</span> -u | \
...</code><button class="copy-button">Copy</button></pre><p><em>OpenDNS and PhishTank are either trademarks or registered trademarks of OpenDNS, LLC.</em></p></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Last Updated:</span> <time class="dt-updated" datetime="2020-07-11T00:00:00.000Z" itemprop="dateModified">11 Jul 2020</time></li><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2020-07-07T00:00:00.000Z" itemprop="datePublished">7 <a href="/blog/2020/07/" title="See July 2020's posts">Jul</a> <a href="/blog/2020/" title="See 2020's posts">2020</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/" rel="tag">Security</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/phishing-filter.md" rel="noopener external nofollow noreferrer">phishing-filter.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2020/07/11/dns-filtering/"><div class="article-nav-title">Comparing malware-blocking DNS providers using URLhaus and PhishTank</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2020/06/03/onion-location-redirect/"><div class="article-nav-title">Onion-Location: redirect your clearnet website to .onion</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>