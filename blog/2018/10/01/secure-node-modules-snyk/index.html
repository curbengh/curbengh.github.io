<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Secure node modules with Snyk | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2018/10/01/secure-node-modules-snyk/"><meta name="description" content="The package dependency on Node can cause security issue. Here&#39;s how to use Snyk to mitigate it."><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="security"><meta property="article:tag" content="javascript"><meta property="article:tag" content="node.js"><meta property="article:tag" content="snyk"><meta property="og:type" content="article"><meta property="og:title" content="Secure node modules with Snyk"><meta property="og:url" content="https://mdleom.com/blog/2018/10/01/secure-node-modules-snyk/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="The package dependency on Node can cause security issue. Here&#39;s how to use Snyk to mitigate it."><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2018/10/01/secure-node-modules-snyk/"><meta property="article:published_time" content="2018-10-01T00:00:00.000Z"><meta property="article:modified_time" content="2019-06-11T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-secure-node-modules-snyk" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Secure node modules with Snyk <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">The package dependency on Node can cause security issue. Here's how to use Snyk to mitigate it.</p><div class="e-content article-entry" itemprop="articleBody"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Intro"><span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installation"><span class="toc-text">Installation</span></a></li></ol><h2 id="Intro">Intro <a href="#Intro" class="headerlink" title="Intro">§</a></h2><blockquote><p>Click <a href="#Installation">here</a> to go straight to installation guide.</p></blockquote><p>Node.js is infamous for the <a href="https://medium.com/commitlog/the-internet-is-at-the-mercy-of-a-handful-of-people-73fac4bc5068" rel="noopener external nofollow noreferrer">left-pad</a> <a href="https://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm" rel="noopener external nofollow noreferrer">controversy</a>, removing just a single package can break many websites.</p><p>The package dependency can also cause security issue (<a href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes" rel="noopener external nofollow noreferrer">example 1</a>, <a href="https://blog.npmjs.org/post/173526807575/reported-malicious-module-getcookies" rel="noopener external nofollow noreferrer">example 2</a>, <a href="https://blog.npmjs.org/post/185397814280/plot-to-steal-cryptocurrency-foiled-by-the-npm" rel="noopener external nofollow noreferrer">example 3</a>).</p><p>Say you use Package A, which depends on Package B, which depends on Package C and so on.</p><pre><code class="hljs plaintext">A &gt; B &gt; C &gt; D &gt; E</code><button class="copy-button">Copy</button></pre><p>What if Package A uses outdated version of Package B?</p><p>If newer version(s) of Package A has updated its <code>package.json</code> to use updated version of Package B, you simply update your <code>package.json</code> to update Package A.</p><p>What if Package A is no longer maintained? You can fork its repo, update the package and re-publish under a new name. For example, hexo-autonofollow uses <a href="https://snyk.io/test/npm/hexo-autonofollow" rel="noopener external nofollow noreferrer">outdated</a> version of cheerio, hexo-filter-nofollow meanwhile uses <a href="https://github.com/SukkaW/hexo-filter-nofollow/commit/ff122123f08d1765ab3272303914d8a29e0bcd7f" rel="noopener external nofollow noreferrer">more recent</a> version.</p><p>If you have time to fork and more importantly fix any compatibility issue (<a href="https://github.com/mamboer/hexo-filter-cleanup/commit/8d9f2da8276652ef270e943dbf9dcb648e14ed55" rel="noopener external nofollow noreferrer">example</a>), why not?</p><p>Now, what if E is vulnerable? For example, <a href="https://snyk.io/test/npm/hexo-fs" rel="noopener external nofollow noreferrer">hexo-fs</a> package has a vulnerability introduced by <a href="https://snyk.io/vuln/npm:chownr:20180731" rel="noopener external nofollow noreferrer">chownr</a> package. The dependency path is <code>hexo-fs@0.2.3 › chokidar@1.7.0 › fsevents@1.2.4 › node-pre-gyp@0.10.3 › tar@4.4.6 › chownr@1.1.1</code>.</p><p>So, you fork, fix it and republish with a new name. Cool. Here comes the fun part, you also need to instruct tar to go for the <em>renamed</em> package. Fork, fix and republish. Repeat this for all the packages along the path.</p><h2 id="Installation">Installation <a href="#Installation" class="headerlink" title="Installation">§</a></h2><p>Practically, you can use Snyk to patch it, <em>if</em> possible like this <a href="https://snyk.io/test/npm/hexo-all-minifier" rel="noopener external nofollow noreferrer">hexo-all-minifier</a>. Snyk is <a href="https://snyk.io/plans" rel="noopener external nofollow noreferrer">free</a> for open-source projects. Much like any other security products, Snyk is not a silver bullet to the NodeJS issue. Some like <a href="https://snyk.io/test/npm/hexo-fs" rel="noopener external nofollow noreferrer">hexo-fs</a> can’t be fixed (at the time of writing).</p><ol><li><a href="https://app.snyk.io/signup" rel="noopener external nofollow noreferrer">Sign up</a> for a new Snyk account.</li><li>Snyk only supports <a href="https://en.wikipedia.org/wiki/Single_sign-on" rel="noopener external nofollow noreferrer">SSO</a>, no e-mail sign up. You need to have GitHub, Bitbucket, or Google account. It can be a separate account from your current GitHub account. Linking your current GitHub repo to Snyk is <em>optional</em>.</li><li>Once you signed up, go to your account setting, grab the API token and save it in your password manager (or somewhere safe).<br><a href="/img/20181001/snyk-api.png"><img srcset="/img/20181001/snyk-api.png?f=auto&width=320 320w,/img/20181001/snyk-api.png?f=auto&width=468 468w,/img/20181001/snyk-api.png?f=auto&width=768 768w,/img/20181001/snyk-api.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20181001/snyk-api.png?f=auto" title="Snyk API token" alt="Snyk API token" loading="lazy"></a></li><li>Install Snyk,<pre><code class="hljs bash">$ npm install snyk
<span class="hljs-comment"># Add &#x27;node_modules/.bin&#x27; to $PATH, if you haven&#x27;t done so. Check ~/.profile before running the following command.</span>
$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;PATH=&quot;$PATH:./node_modules/.bin&quot;&#x27;</span> &gt;&gt; ~/.profile</code><button class="copy-button">Copy</button></pre></li><li><code>cd</code> into your repo folder.</li><li>Login to Snyk, <code>$ snyk auth</code>. Snyk website will pop-up.</li><li>Once authenticated, you can start to use it.</li><li>Test for vulnerability, <code>$ snyk test</code>.</li><li>If there is any vulnerability, run <code>$ snyk wizard</code>.</li><li>Snyk will prompt you for a possible action (update, patch or ignore).</li><li>Snyk will ask if you want to add its commands to <code>package.json</code>. This allows Snyk to check every time you <code>$ npm install</code>. I don’t add it because it doesn’t play nice with CI.</li><li><code>.snyk</code> file will be created. You can review it in a text editor.</li><li>If fix is available, run <code>$ snyk protect</code>.</li><li>In step 10, if you choose to ignore, Snyk will ignore the issue for 30 days by default (even after you run <code>snyk test</code>. Once elapsed, <code>$ snyk test</code> will say there is vulnerability again (and fail your build&#x2F;CI). If you find it annoying, you can delay the expiry date in <code>.snyk</code>.</li><li>Lastly, link the project to your Snyk account, <code>$ snyk monitor</code>. Your project will shows up at your Snyk account. Go to the project setting and add your github repo link. This is necessary to remove usage quota for open-source projects.</li><li>Optional: add <code>snyk test</code>, <code>snyk protect</code> and <code>snyk monitor</code> commands to your CI script to protect your CI build image.</li></ol><p><em><strong>Attention:</strong></em> Snyk depends on GNU version of <code>patch</code> utility, so you need to install it if the CI build environment is Alpine or BSD. Otherwise, <code>snyk protect</code> won’t work. Read my <a href="/blog/2018/10/31/snyk-patch-alpine-docker/" title="Snyk failed to patch in Alpine docker">newer post</a> for more info.</p><p><em><strong>Edit:</strong></em> Snyk <a href="https://github.com/snyk/snyk/releases/tag/v1.131.0" rel="noopener external nofollow noreferrer">v1.131.0</a> onwards no longer use <code>patch</code>.</p><p>Alternatively, you could integrate directly to your remote repo (github&#x2F;gitlab). This integration allows Snyk to automatically create pull&#x2F;merge request. Enable this by going to your Snyk account and Integrations tab.</p><p><a href="/img/20181001/snyk-integration.png"><img srcset="/img/20181001/snyk-integration.png?f=auto&width=320 320w,/img/20181001/snyk-integration.png?f=auto&width=468 468w,/img/20181001/snyk-integration.png?f=auto&width=768 768w,/img/20181001/snyk-integration.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20181001/snyk-integration.png?f=auto" title="Available integrations offered by Snyk" alt="Available integrations offered by Snyk" loading="lazy"></a></p><p>More info: <a href="https://snyk.io/docs/snyk-for-nodejs" rel="noopener external nofollow noreferrer">NodeJS</a>, <a href="https://snyk.io/docs/github" rel="noopener external nofollow noreferrer">GitHub</a>, <a href="https://snyk.io/docs/gitlab" rel="noopener external nofollow noreferrer">GitLab</a></p><p>Recommended reading: <a href="https://hackernoon.com/im-harvesting-credit-card-numbers-and-passwords-from-your-site-here-s-how-9a8cb347c5b5" rel="noopener external nofollow noreferrer">Hackernoon’s article</a> and the <a href="https://hackernoon.com/part-2-how-to-stop-me-harvesting-credit-card-numbers-and-passwords-from-your-site-844f739659b9" rel="noopener external nofollow noreferrer">follow-up post</a>.</p></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Last Updated:</span> <time class="dt-updated" datetime="2019-06-11T00:00:00.000Z" itemprop="dateModified">11 Jun 2019</time></li><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2018-10-01T00:00:00.000Z" itemprop="datePublished">1 <a href="/blog/2018/10/" title="See October 2018's posts">Oct</a> <a href="/blog/2018/" title="See 2018's posts">2018</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/" rel="tag">Node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/" rel="tag">Security</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/snyk/" rel="tag">Snyk</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/secure-node-modules-snyk.md" rel="noopener external nofollow noreferrer">secure-node-modules-snyk.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2018/10/02/hide-folders-caja-side-pane/"><div class="article-nav-title">Hide folders of Caja side pane</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2018/09/28/make-hexo-blog-smaller/"><div class="article-nav-title">Make Hexo blog smaller</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>