<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Query LOCKOUT and PASSWORD_EXPIRED flags on Splunk SA-ldapsearch | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2023/10/01/splunk-ldapsearch-useraccountcontrol/"><meta name="description" content="userAccountControl vs. msDS-User-Account-Control-Computed"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="splunk"><meta property="og:type" content="article"><meta property="og:title" content="Query LOCKOUT and PASSWORD_EXPIRED flags on Splunk SA-ldapsearch"><meta property="og:url" content="https://mdleom.com/blog/2023/10/01/splunk-ldapsearch-useraccountcontrol/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="userAccountControl vs. msDS-User-Account-Control-Computed"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2023/10/01/splunk-ldapsearch-useraccountcontrol/"><meta property="article:published_time" content="2023-10-01T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-splunk-ldapsearch-useraccountcontrol" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Query LOCKOUT and PASSWORD_EXPIRED flags on Splunk SA-ldapsearch <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">userAccountControl vs. msDS-User-Account-Control-Computed</p><div class="e-content article-entry" itemprop="articleBody"><p><a href="https://splunkbase.splunk.com/app/1151" rel="noopener external nofollow noreferrer">SA-ldapsearch</a> (Splunk Supporting Add-on for Active Directory) has a useful feature that parses “userAccountControl” flags into a multivalue. For example, instead of showing “514”, it shows <code>[ACCOUNTDISABLE, NORMAL_ACCOUNT]</code> instead. However, I noticed <code>LOCKOUT</code> and <code>PASSWORD_EXPIRED</code> flags are not shown even though I was sure the accounts I queried have either of those flags set. Those flags are indeed listed under documentations for “userAccountControl”: <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties#list-of-property-flags" rel="noopener external nofollow noreferrer">Windows Server</a> and <a href="https://learn.microsoft.com/en-gb/windows/win32/adschema/a-useraccountcontrol" rel="noopener external nofollow noreferrer">Active Directory Schema</a>.</p><p>Despite being mentioned in the documentations, in that Windows Server doc, there is a note that says those flags have been moved to “<a href="https://learn.microsoft.com/en-gb/windows/win32/adschema/a-msds-user-account-control-computed" rel="noopener external nofollow noreferrer">msDS-User-Account-Control-Computed</a>“ attribute since Windows Server 2003. But when I queried that attribute, I got a decimal value which meant the parsing function was not applied.</p><p>To apply flag-parsing function on “msDS-User-Account-Control-Computed”:</p><pre><div class="caption"><span>SA-ldapsearch/bin/packages/app/formatting_extensions.py</span></div><code class="hljs python"><span class="hljs-string">&#x27;1.2.840.113556.1.4.8&#x27;</span>:             format_user_flag_enum,         <span class="hljs-comment"># User-Account-Control</span>
<span class="hljs-string">&#x27;1.2.840.113556.1.4.1460&#x27;</span>:          format_user_flag_enum,         <span class="hljs-comment"># ms-DS-User-Account-Control-Computed</span></code><button class="copy-button">Copy</button></pre><p>First line is an existing one, the second line is the new one.</p><p>For the sake of completeness, that function can also be patched to parse other flags of “msDS-User-Account-Control-Computed”. I created <a href="https://gitlab.com/curben/splunk-scripts/-/tree/main/SA-ldapsearch?ref_type=heads" rel="noopener external nofollow noreferrer">a script</a> to apply the following patch directly on “<a href="https://splunkbase.splunk.com/app/1151" rel="noopener external nofollow noreferrer">splunk-supporting-add-on-for-active-directory_*.tgz</a>“ and save it to a new app package “SA-ldapsearch_*.tgz”.</p><pre><code class="hljs patch"><span class="hljs-comment">--- SA-ldapsearch/bin/packages/app/formatting_extensions.py  2023-09-06 00:00:00.000000000 +0000</span>
<span class="hljs-comment">+++ SA-ldapsearch/bin/packages/app/formatting_extensions.py  2023-09-06 00:00:00.000000001 +0000</span>
<span class="hljs-meta">@@ -721,6 +721,12 @@</span>
         names.append(&#x27;PASSWORD_EXPIRED&#x27;)
     if flags &amp; 0x1000000:
         names.append(&#x27;TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION&#x27;)
<span class="hljs-addition">+    if flags &amp; 0x2000000:</span>
<span class="hljs-addition">+        names.append(&#x27;NO_AUTH_DATA_REQUIRED&#x27;)</span>
<span class="hljs-addition">+    if flags &amp; 0x4000000:</span>
<span class="hljs-addition">+        names.append(&#x27;PARTIAL_SECRETS_ACCOUNT&#x27;)</span>
<span class="hljs-addition">+    if flags &amp; 0x8000000:</span>
<span class="hljs-addition">+        names.append(&#x27;USE_AES_KEYS&#x27;)</span>

     # Zero or one of these flags may be set

<span class="hljs-meta">@@ -822,6 +828,7 @@</span>
     &#x27;1.2.840.113556.1.4.1303&#x27;:          format_sid,                    # Token-Groups-No-GC-Acceptable

     &#x27;1.2.840.113556.1.4.8&#x27;:             format_user_flag_enum,         # User-Account-Control
<span class="hljs-addition">+    &#x27;1.2.840.113556.1.4.1460&#x27;:          format_user_flag_enum,         # ms-DS-User-Account-Control-Computed</span>

     # formatter specially for msExchMailboxSecurityDescriptor
     &#x27;1.2.840.113556.1.4.7000.102.80&#x27; : format_security_descriptor,     # msExchMailboxSecurityDescriptor
</code><button class="copy-button">Copy</button></pre></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2023-10-01T00:00:00.000Z" itemprop="datePublished">1 <a href="/blog/2023/10/" title="See October 2023's posts">Oct</a> <a href="/blog/2023/" title="See 2023's posts">2023</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/splunk/" rel="tag">Splunk</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/splunk-ldapsearch-useraccountcontrol.md" rel="noopener external nofollow noreferrer">splunk-ldapsearch-useraccountcontrol.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2024/02/24/splunk-app-acl/"><div class="article-nav-title">Applying default-deny ACL in Splunk app</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2023/08/27/saml-scim/"><div class="article-nav-title">Azure AD SSO integration with ServiceNow</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>