<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Firefox, Cross-Origin and AliExpress | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2019/02/28/aliexpress-no-login-firefox/"><meta name="description" content="AliExpress login doesn&#39;t show up on Firefox when there is a strict cross-origin policy."><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="firefox"><meta property="og:type" content="article"><meta property="og:title" content="Firefox, Cross-Origin and AliExpress"><meta property="og:url" content="https://mdleom.com/blog/2019/02/28/aliexpress-no-login-firefox/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="AliExpress login doesn&#39;t show up on Firefox when there is a strict cross-origin policy."><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2019/02/28/aliexpress-no-login-firefox/"><meta property="article:published_time" content="2019-02-28T00:00:00.000Z"><meta property="article:modified_time" content="2019-04-29T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-aliexpress-no-login-firefox" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Firefox, Cross-Origin and AliExpress <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">AliExpress login doesn't show up on Firefox when there is a strict cross-origin policy.</p><div class="e-content article-entry" itemprop="articleBody"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#My-Orders"><span class="toc-text">My Orders</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reset-referer-policy"><span class="toc-text">Reset referer policy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%9CIgnore-X-Frame-Options%E2%80%9D-extension"><span class="toc-text">“Ignore X-Frame-Options” extension</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Direct-link"><span class="toc-text">Direct link</span></a></li></ol><p>AliExpress login doesn’t show up on Firefox when there is a strict cross-origin policy (i.e. <code>network.http.referer.XOriginPolicy</code>). Here’s how to whitelist it.</p><h2 id="Background">Background <a href="#Background" class="headerlink" title="Background">§</a></h2><blockquote><p>Click <a href="#My-Orders"><strong>here</strong></a> to go straight to the workarounds.</p></blockquote><p>Firefox can restrict the referrer to the same origin only (<a href="https://wiki.mozilla.org/Security/Referrer" rel="noopener external nofollow noreferrer">docs</a>), by setting <code>network.http.referer.XOriginPolicy</code> value to 2 in <code>about:config</code>. Initially, I figured this would break many websites. But to my surprise, I have yet to encounter any issue; well, <em>except</em> for AliExpress.</p><p>When you try to login to AliExpress, the login box is just blank.</p><p><a href="/img/20190228/no-login.png"><img srcset="/img/20190228/no-login.png?f=auto&width=320 320w,/img/20190228/no-login.png?f=auto&width=468 468w,/img/20190228/no-login.png?f=auto&width=768 768w,/img/20190228/no-login.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/no-login.png?f=auto" title="Blank aliexpress login box" alt="Blank aliexpress login box" loading="lazy"></a></p><p>In the new design, the loading wheel just keeps spinning.</p><p><a href="/img/20190228/invalid-login.png"><img srcset="/img/20190228/invalid-login.png?f=auto&width=320 320w,/img/20190228/invalid-login.png?f=auto&width=468 468w,/img/20190228/invalid-login.png?f=auto&width=768 768w,/img/20190228/invalid-login.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/invalid-login.png?f=auto" title="Aliexpress login pop-up keeps loading" alt="Aliexpress login pop-up keeps loading" loading="lazy"></a></p><p>Upon inspection on the blank element (right click on the blank login and select <code>Inspect Element</code>), the login box is an iframe of <code>https://passport.aliexpress.com</code>. From the Web Console (<code>Ctrl + Shift + K</code>), the following error message suggested it’s caused by <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" rel="noopener external nofollow noreferrer">X-Frame-Options</a>.</p><p><a href="/img/20190228/iframe.png"><img srcset="/img/20190228/iframe.png?f=auto&width=320 320w,/img/20190228/iframe.png?f=auto&width=468 468w,/img/20190228/iframe.png?f=auto&width=768 768w,/img/20190228/iframe.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/iframe.png?f=auto" title="Aliexpress login page under an iframe" alt="Aliexpress login page under an iframe" loading="lazy"></a><br><a href="/img/20190228/x-frame.png"><img srcset="/img/20190228/x-frame.png?f=auto&width=320 320w,/img/20190228/x-frame.png?f=auto&width=468 468w,/img/20190228/x-frame.png?f=auto&width=768 768w,/img/20190228/x-frame.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/x-frame.png?f=auto" title="Console error of Aliexpress login" alt="Console error of Aliexpress login" loading="lazy"></a></p><p>From the Network inspection (<code>Ctrl + Shift + E</code>), <code>https://passport.aliexpress.com</code> has HTTP header <code>x-frame-options: SAMEORIGIN</code> (which I believe stems from the <code>XOriginPolicy</code> setting). This restricts the iframe to the same domain. This caused the iframe unable to load because it’s different from the login page <code>https://login.aliexpress.com</code>.</p><p><a href="/img/20190228/sameorigin.png"><img srcset="/img/20190228/sameorigin.png?f=auto&width=320 320w,/img/20190228/sameorigin.png?f=auto&width=468 468w,/img/20190228/sameorigin.png?f=auto&width=768 768w,/img/20190228/sameorigin.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/sameorigin.png?f=auto" title="Aliexpress x-frame-options is sameorigin" alt="Aliexpress x-frame-options is sameorigin" loading="lazy"></a></p><p><strong>Edit:</strong> After pinpoint the issue to <code>XOriginPolicy</code>, I suspect AliExpress sends the referrer from <code>login</code> to <code>passport</code> for tracking purpose, and somehow <code>passport</code> could not be loaded if it does not receive any referrer. There are a few options to resolve this.</p><h2 id="My-Orders">My Orders <a href="#My-Orders" class="headerlink" title="My Orders">§</a></h2><p><strong>Edit:</strong> This step alone doesn’t work anymore, requires resetting referer policy. See <a href="#Reset-referer-policy">next section</a>.</p><p>To use the old login page, mouse-over on the <strong>Account</strong> link at the top right corner and click on <strong>My Orders</strong>. It should redirects to <code>https://login.aliexpress.com/...</code></p><p><a href="/img/20190228/my-orders.png"><img srcset="/img/20190228/my-orders.png?f=auto&width=320 320w,/img/20190228/my-orders.png?f=auto&width=468 468w,/img/20190228/my-orders.png?f=auto&width=768 768w,/img/20190228/my-orders.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/my-orders.png?f=auto" title="Aliexpress &#39;My Orders&#39; link" alt="Aliexpress &#39;My Orders&#39; link" loading="lazy"></a></p><h2 id="Reset-referer-policy">Reset referer policy <a href="#Reset-referer-policy" class="headerlink" title="Reset referer policy">§</a></h2><ol><li>Go to <a href="about:config" rel="noopener external nofollow noreferrer">about:config</a>.</li><li>Search for “referer”, then adjust the following option,</li></ol><pre><code class="hljs plaintext">network.http.referer.defaultPolicy;1 (must be &#x27;1&#x27; or above)
network.http.referer.sendRefererHeader;2</code><button class="copy-button">Copy</button></pre><ol start="3"><li>Mouse-over on the <strong>Account</strong> link at the top right corner and click on <strong>My Orders</strong>. It should redirects to <code>https://login.aliexpress.com/...</code></li></ol><h2 id="“Ignore-X-Frame-Options”-extension">“Ignore X-Frame-Options” extension <a href="#“Ignore-X-Frame-Options”-extension" class="headerlink" title="“Ignore X-Frame-Options” extension">§</a></h2><p><a href="https://addons.mozilla.org/en-US/firefox/addon/ignore-x-frame-options-header/" rel="noopener external nofollow noreferrer"><strong>Ignore X-Frame-Options</strong></a> Firefox extension is a way to whitelist the domain from the restriction. By default, the extension whitelist all domains. This is highly discouraged because it nullifies the security benefits of x-frame-options (e.g. prevent a banking website from being iframe-d inside a phishing website). Instead, we can whitelist the login page only.</p><pre><code class="hljs plaintext">https://passport.aliexpress.com/*</code><button class="copy-button">Copy</button></pre><p><a href="/img/20190228/whitelist.png"><img srcset="/img/20190228/whitelist.png?f=auto&width=320 320w,/img/20190228/whitelist.png?f=auto&width=468 468w,/img/20190228/whitelist.png?f=auto&width=768 768w,/img/20190228/whitelist.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/whitelist.png?f=auto" title="Add a whitelist to &#39;Ignore X-Frame-Options&#39;" alt="Add a whitelist to &#39;Ignore X-Frame-Options&#39;" loading="lazy"></a></p><p>That’s how the whitelist works on the extension; you add the domain of the iframe not the page’s domain. After you add it to the list, refresh the page and you should see the login.</p><p><a href="/img/20190228/login.png"><img srcset="/img/20190228/login.png?f=auto&width=320 320w,/img/20190228/login.png?f=auto&width=468 468w,/img/20190228/login.png?f=auto&width=768 768w,/img/20190228/login.png?f=auto 800w" sizes="(max-width: 320px) 320px,(max-width: 468px) 468px,(max-width: 768px) 768px,800px" src="/img/20190228/login.png?f=auto" title="Regular Aliexpress login page" alt="Regular Aliexpress login page" loading="lazy"></a></p><h2 id="Direct-link">Direct link <a href="#Direct-link" class="headerlink" title="Direct link">§</a></h2><p>If none of the above work, the last resort is to use the direct link <a href="https://login.aliexpress.com/express/mulSiteLogin.htm" rel="noopener external nofollow noreferrer">https://login.aliexpress.com/express/mulSiteLogin.htm</a></p></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Last Updated:</span> <time class="dt-updated" datetime="2019-04-29T00:00:00.000Z" itemprop="dateModified">29 Apr 2019</time></li><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2019-02-28T00:00:00.000Z" itemprop="datePublished">28 <a href="/blog/2019/02/" title="See February 2019's posts">Feb</a> <a href="/blog/2019/" title="See 2019's posts">2019</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/firefox/" rel="tag">Firefox</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/aliexpress-no-login-firefox.md" rel="noopener external nofollow noreferrer">aliexpress-no-login-firefox.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2019/04/04/doh-tls-privacy/"><div class="article-nav-title">DNS-over-TLS/DNS-over-HTTPS does not protect your privacy</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2019/02/09/statistical-test/"><div class="article-nav-title">Which statistical test should I use?</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>