<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Javascript Unit Testing with Jest | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2019/12/30/unit-testing-jest/"><meta name="description" content="Jest &#x3D; Chai + Mocha + NYC + Sinon"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="javascript"><meta property="og:type" content="article"><meta property="og:title" content="Javascript Unit Testing with Jest"><meta property="og:url" content="https://mdleom.com/blog/2019/12/30/unit-testing-jest/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="Jest &#x3D; Chai + Mocha + NYC + Sinon"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2019/12/30/unit-testing-jest/"><meta property="article:published_time" content="2019-12-30T00:00:00.000Z"><meta property="article:modified_time" content="2020-09-28T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-unit-testing-jest" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Javascript Unit Testing with Jest <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">Jest = Chai + Mocha + NYC + Sinon</p><div class="e-content article-entry" itemprop="articleBody"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#toContain-item"><span class="toc-text">.toContain(item)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#expect-arrayContaining-array"><span class="toc-text">expect.arrayContaining(array)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#expect-not-arrayContaining-array"><span class="toc-text">expect.not.arrayContaining(array)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mock-calls"><span class="toc-text">mock.calls</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toBeDefined"><span class="toc-text">.toBeDefined()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Buffer-equals"><span class="toc-text">Buffer.equals()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Coverage"><span class="toc-text">Coverage</span></a></li></ol><p>Recently, I finally implement unit tests for hexo-yam, which it lacked for too long than I would like. I’ve grown pretty familiar with Chai + Mocha as part of my work in HexoJS. But I’m not particularly fond of them, due to my <a href="https://github.com/hexojs/hexo-generator-sitemap/pull/66" rel="noopener external nofollow noreferrer">previous</a> <a href="https://github.com/hexojs/hexo-generator-sitemap/pull/70" rel="noopener external nofollow noreferrer">frustation</a>. I started to look for alternatives. Initially, I was intrigued by <a href="https://github.com/avajs/ava" rel="noopener external nofollow noreferrer">ava</a> used in <a href="https://github.com/hexojs/hexo-filter-responsive-images" rel="noopener external nofollow noreferrer">hexo-filter-responsive-images</a> plugin, but the name just stuck as a todo as I work on more pressing issues in HexoJS.</p><p>I planned to release a new major version (v4) of hexo-yam immediately after NodeJS 8 is approaching end-of-life, which is the end of 2019. The highlight of v4 is solely using the native zlib API to do Brotli compression (supported since NodeJS 10.16) and not rely on the iltorb library. I also really, <em>really</em> wanted to have unit tests as part of that release too.</p><p>A few weeks ago, I stumbled upon Jest through <a href="https://2019.stateofjs.com/testing/" rel="noopener external nofollow noreferrer">The State of Javascript 2019</a> which was shared on HN. Jest has the highest satisfaction score among the testing frameworks. I had a quick look at <a href="https://www.npmjs.com/package/jest" rel="noopener external nofollow noreferrer">npmjs</a> and noticed the size is smaller than <a href="https://www.npmjs.com/package/mocha" rel="noopener external nofollow noreferrer">mocha</a> and <a href="https://www.npmjs.com/package/ava" rel="noopener external nofollow noreferrer">ava</a>, which I felt weird as it offers much more features. I later found out it has <a href="https://github.com/facebook/jest/blob/9419034d6b575fe2c157453fe8b7d2000be66aad/package.json#L4-L78" rel="noopener external nofollow noreferrer"><em>a lot</em></a> of dependencies. The size shown at npmjs is actually misleading when the installation size is 32MB (as of <a href="https://packagephobia.now.sh/result?p=jest@24.9.0" rel="noopener external nofollow noreferrer">v24.9</a>), much larger than mocha (<a href="https://packagephobia.now.sh/result?p=mocha@6.2.2" rel="noopener external nofollow noreferrer">5.5MB</a>) and ava (<a href="https://packagephobia.now.sh/result?p=ava@2.4.0" rel="noopener external nofollow noreferrer">14.8MB</a>). The reason for that is mentioned in the next paragraph.</p><p>A quick glance through its <a href="https://jestjs.io/" rel="noopener external nofollow noreferrer">homepage</a> shows it has built-in code coverage and mocking, which covers NYC and Sinon. Another look at the quick start <a href="https://jestjs.io/docs/en/getting-started" rel="noopener external nofollow noreferrer">guide</a> shows it can execute unit test, which covers Mocha and Chai. All-in-one. So far so good, let’s take the plunge.</p><p>I skipped the example unit test and jumped right into testing the <a href="https://github.com/curbengh/hexo-yam/blob/fa6f514a05c7fcff977745c6afeb02e07f59659b/lib/filter.js#L61" rel="noopener external nofollow noreferrer"><code>minifyHtml()</code></a>. I had a rough start as Jest kept complaining it can’t find the test, even though I’ve specified it <code>$ jest test/filter.test.js</code>. It was only after I initialised it <code>$ jest init</code> and selected “node” environment, that jest managed to execute the test. Jest defaults to <a href="https://jestjs.io/docs/en/configuration#testenvironment-string" rel="noopener external nofollow noreferrer">“jsdom”</a> environment, which is browser-like environment different to the scope of hexo-yam. The initialisation resulted in <code>jest.config.js</code> with the following content:</p><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;
  <span class="hljs-string">&quot;clearMocks&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;coverageDirectory&quot;</span>: <span class="hljs-string">&quot;coverage&quot;</span>,
  <span class="hljs-string">&quot;testEnvironment&quot;</span>: <span class="hljs-string">&quot;node&quot;</span>
&#125;</code><button class="copy-button">Copy</button></pre><p>Since it’s only three lines and I prefer to minimise the files, I moved the config to package.json instead,</p><pre><code class="hljs json"><span class="hljs-attr">&quot;jest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;clearMocks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;coverageDirectory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./coverage/&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;testEnvironment&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node&quot;</span>
<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span></code><button class="copy-button">Copy</button></pre><p>Now, hexo-yam has many defaults to maximise the compressions. I prefer not to repeat the same config in the unit test, so I declared them as objects and module-export.</p><p>Edit (28 Sep 2020): I now find using module-export simply for the purpose of unit testing to be a bit <em>unhygienic</em>, so I no longer use this approach, now default config is declared in each test instead.</p><pre><div class="caption"><span>index.js</span></div><code class="hljs js"><span class="hljs-comment">// the actual object has many properties, this is just a preview</span>
<span class="hljs-keyword">const</span> htmlDefault = &#123;
  <span class="hljs-attr">minifyJS</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">minifyCSS</span>: <span class="hljs-literal">true</span>
&#125;

hexo.<span class="hljs-property">config</span>.<span class="hljs-property">minify</span>.<span class="hljs-property">html</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(htmlDefault, hexo.<span class="hljs-property">config</span>.<span class="hljs-property">minify</span>.<span class="hljs-property">html</span>)

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;
  htmlDefault
&#125;</code><button class="copy-button">Copy</button></pre><p>Then in the test, I simply import <code>htmlDefault</code> object,</p><pre><div class="caption"><span>test/html.test.js</span></div><code class="hljs js"><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;
  <span class="hljs-keyword">const</span> &#123; htmlDefault &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../index&#x27;</span>)

  <span class="hljs-comment">// reset config before each test</span>
  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> &#123;
    hexo.<span class="hljs-property">config</span>.<span class="hljs-property">minify</span>.<span class="hljs-property">html</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, htmlDefault)
  &#125;)

  <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;default&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;
    <span class="hljs-title function_">expect</span>(result).<span class="hljs-title function_">toBe</span>(expected)
  &#125;)
&#125;)</code><button class="copy-button">Copy</button></pre><p>On a side note,</p><pre><code class="hljs js">hexo.<span class="hljs-property">config</span>.<span class="hljs-property">minify</span>.<span class="hljs-property">html</span> = htmlDefault
<span class="hljs-comment">/*</span>
<span class="hljs-comment">This line wouldn&#x27;t work because any change to hexo.config.minify.html</span>
<span class="hljs-comment">also change htmlDefault, as it is a pointer.</span>
<span class="hljs-comment">In this case, htmlDefault shouldn&#x27;t be modified, so Object.assign(&#123;&#125;, htmlDefault)</span>
<span class="hljs-comment">is used to clone it and keep those two objects separated</span>
<span class="hljs-comment">/*</span></code><button class="copy-button">Copy</button></pre><p>The next error I encountered is that <code>&quot;hexo&quot; is not declared</code>. This is expected as hexo-yam is a plugin that utilizes “hexo” global object. So, I simply need to install “hexo” as a dev dependency and declare it as a global object.</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Hexo</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hexo&#x27;</span>)
<span class="hljs-comment">// __dirname (in this case) refers to the test/ folder</span>
<span class="hljs-comment">// I use it to confine &quot;hexo&quot; to that folder</span>
<span class="hljs-comment">// In my case, there is actually no practical difference,</span>
<span class="hljs-comment">// since my unit test doesn&#x27;t involve filesystem (yet)</span>
<span class="hljs-comment">// I keep it just in case</span>
<span class="hljs-keyword">const</span> hexo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hexo</span>(__dirname)
<span class="hljs-variable language_">global</span>.<span class="hljs-property">hexo</span> = hexo

<span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;
&#125;)</code><button class="copy-button">Copy</button></pre><p>After that, the first unit test ran without any hitch, so I started to write unit tests. Here are some notable functions (called <em>matchers</em>) which I found useful,</p><h2 id="toContain-item"><a href="https://jestjs.io/docs/en/expect#tocontainitem" rel="noopener external nofollow noreferrer">.toContain(item)</a> <a href="#toContain-item" class="headerlink" title=".toContain(item)">§</a></h2><p>This is equivalent to <code>String.includes()</code> and <code>Array.includes()</code>.</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> foo = <span class="hljs-string">&#x27;Cras dictum feugiat tellus eget convallis&#x27;</span>
<span class="hljs-comment">// Instead of</span>
<span class="hljs-title function_">expect</span>(foo.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;tellus&#x27;</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>))

<span class="hljs-comment">// you can use</span>
<span class="hljs-title function_">expect</span>(foo).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">&#x27;tellus&#x27;</span>))</code><button class="copy-button">Copy</button></pre><p>When used to check an array, it only checks for <em>an element</em>. If you need to check for multiple elements, use <code>expect.arrayContaining(array)</code></p><h2 id="expect-arrayContaining-array"><a href="https://jestjs.io/docs/en/expect#expectarraycontainingarray" rel="noopener external nofollow noreferrer">expect.arrayContaining(array)</a> <a href="#expect-arrayContaining-array" class="headerlink" title="expect.arrayContaining(array)">§</a></h2><p>Check for multiple elements</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> result = [<span class="hljs-string">&#x27;aliquet&#x27;</span>, <span class="hljs-string">&#x27;leo&#x27;</span>, <span class="hljs-string">&#x27;sit&#x27;</span>, <span class="hljs-string">&#x27;amet&#x27;</span>]
<span class="hljs-keyword">const</span> expected = [<span class="hljs-string">&#x27;aliquet&#x27;</span>, <span class="hljs-string">&#x27;amet&#x27;</span>]
<span class="hljs-title function_">expect</span>(result).<span class="hljs-title function_">toEqual</span>(expect.<span class="hljs-title function_">arrayContaining</span>(expected))</code><button class="copy-button">Copy</button></pre><h2 id="expect-not-arrayContaining-array"><a href="https://jestjs.io/docs/en/expect#expectnotarraycontainingarray" rel="noopener external nofollow noreferrer">expect.not.arrayContaining(array)</a> <a href="#expect-not-arrayContaining-array" class="headerlink" title="expect.not.arrayContaining(array)">§</a></h2><pre><code class="hljs js"><span class="hljs-keyword">const</span> result = [<span class="hljs-string">&#x27;aliquet&#x27;</span>, <span class="hljs-string">&#x27;leo&#x27;</span>, <span class="hljs-string">&#x27;sit&#x27;</span>, <span class="hljs-string">&#x27;amet&#x27;</span>]
<span class="hljs-keyword">const</span> expected = [<span class="hljs-string">&#x27;blandit&#x27;</span>, <span class="hljs-string">&#x27;tellus&#x27;</span>]
<span class="hljs-title function_">expect</span>(result).<span class="hljs-title function_">toEqual</span>(expect.<span class="hljs-property">not</span>.<span class="hljs-title function_">arrayContaining</span>(expected))</code><button class="copy-button">Copy</button></pre><h2 id="mock-calls"><a href="https://jestjs.io/docs/en/mock-function-api#mockfnmockcalls" rel="noopener external nofollow noreferrer">mock.calls</a> <a href="#mock-calls" class="headerlink" title="mock.calls">§</a></h2><p>When <code>verbose:</code> option is enabled, the plugin would output <code>$&#123;feature&#125;: &#123;path&#125; [$&#123;percentage&#125;% saved]</code> to stdout using <code>hexo.log.log()</code>. The percentage is the size difference between the original and minified file.</p><p>Example output:</p><pre><code class="hljs plaintext">html: foo/bar/baz.html [10.10% saved]</code><button class="copy-button">Copy</button></pre><pre><code class="hljs js"><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;option - verbose&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;
  <span class="hljs-comment">// enable verbose</span>
  hexo.<span class="hljs-property">config</span>.<span class="hljs-property">minify</span>.<span class="hljs-property">html</span>.<span class="hljs-property">verbose</span> = <span class="hljs-literal">true</span>

  <span class="hljs-comment">// first we mock the hexo.log.log</span>
  hexo.<span class="hljs-property">log</span>.<span class="hljs-property">log</span> = jest.<span class="hljs-title function_">fn</span>()

  <span class="hljs-comment">// call the minifier function</span>
  <span class="hljs-title function_">minifyHtml</span>()
&#125;)</code><button class="copy-button">Copy</button></pre><p>Initially I tested it by using <a href="https://jestjs.io/docs/en/expect#tohavebeencalledwitharg1-arg2-" rel="noopener external nofollow noreferrer"><code>.toHaveBeenCalledWith(arg)</code></a></p><pre><code class="hljs js"><span class="hljs-title function_">expect</span>(hexo.<span class="hljs-property">log</span>.<span class="hljs-property">log</span>).<span class="hljs-title function_">toHaveBeenCalledWith</span>(<span class="hljs-string">`html: foo/bar/baz.html [10.10% saved]`</span>);</code><button class="copy-button">Copy</button></pre><p>Then I realized the percentage could change as upstream minifiers get enhanced or even regressed. However, since the test input is just a line of code, it’s practically impossible that the percentage will change. Yet, to be safe, I skip checking the percentage,</p><pre><code class="hljs js"><span class="hljs-title function_">expect</span>(hexo.<span class="hljs-property">log</span>.<span class="hljs-property">log</span>.<span class="hljs-property">mock</span>.<span class="hljs-property">calls</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">&#x27;html: foo/bar/baz.html&#x27;</span>)</code><button class="copy-button">Copy</button></pre><p><code>[0][0]</code>, first dimension [0] refers to the first argument, second dimension [0] referts to the first call. I use this because there is only one argument and the mock call is cleared before every test (<a href="https://jestjs.io/docs/en/configuration#clearmocks-boolean" rel="noopener external nofollow noreferrer"><code>clearMocks: true</code></a>) so there is no second call.</p><h2 id="toBeDefined"><a href="https://jestjs.io/docs/en/expect#tobedefined" rel="noopener external nofollow noreferrer">.toBeDefined()</a> <a href="#toBeDefined" class="headerlink" title=".toBeDefined()">§</a></h2><p>This is equivalent to <code>typeof result !== &#39;undefined&#39;</code>.</p><p>If you want to check for <code>undefined</code>, use <a href="https://jestjs.io/docs/en/expect#tobeundefined" rel="noopener external nofollow noreferrer"><code>.toBeUnfefined()</code></a></p><h2 id="Buffer-equals"><a href="https://nodejs.org/docs/latest-v12.x/api/buffer.html#buffer_buf_equals_otherbuffer" rel="noopener external nofollow noreferrer">Buffer.equals()</a> <a href="#Buffer-equals" class="headerlink" title="Buffer.equals()">§</a></h2><p>It’s not directly related Jest, but I stumbled upon it through its docs. This is useful when comparing two Buffer objects with different encoding.</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(foo, <span class="hljs-string">&#x27;binary&#x27;</span>)
<span class="hljs-keyword">const</span> expected = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(foo, <span class="hljs-string">&#x27;base64&#x27;</span>)

<span class="hljs-comment">// instead of</span>
<span class="hljs-title function_">expect</span>(result.<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>)).<span class="hljs-title function_">toBe</span>(expected)

<span class="hljs-comment">// use</span>
<span class="hljs-title function_">expect</span>(result.<span class="hljs-title function_">equals</span>(expected)).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)</code><button class="copy-button">Copy</button></pre><h2 id="Coverage">Coverage <a href="#Coverage" class="headerlink" title="Coverage">§</a></h2><p>To show coverage report,</p><pre><code class="hljs diff">package.json
&quot;jest&quot;: &#123;
  &quot;clearMocks&quot;: true,
<span class="hljs-addition">+  &quot;collectCoverage&quot;: true,</span>
  &quot;coverageDirectory&quot;: &quot;coverage&quot;,
  &quot;testEnvironment&quot;: &quot;node&quot;
&#125;,</code><button class="copy-button">Copy</button></pre><pre><code class="hljs diff">.gitignore
<span class="hljs-addition">+coverage/</span></code><button class="copy-button">Copy</button></pre><p>To upload it codecov, add the following lines to CI config,</p><pre><code class="hljs yml"><span class="hljs-attr">after_script:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">codecov</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">codecov</span></code><button class="copy-button">Copy</button></pre><p>and add <code>CODECOV_TOKEN</code> to the CI environment variable.</p><p>Currently, there are 58 unit tests in hexo-yam which gives 99% of coverage. <a href="https://github.com/curbengh/hexo-yam/blob/fa6f514a05c7fcff977745c6afeb02e07f59659b/lib/filter.js#L207" rel="noopener external nofollow noreferrer">This line</a> is the only one not covered. The catches any error thrown by <a href="https://nodejs.org/docs/latest-v12.x/api/zlib.html#zlib_zlib_brotlicompress_buffer_options_callback" rel="noopener external nofollow noreferrer"><code>zlib.brotliCompress</code></a>.</p><p>One way to make it throw error is to pass invalid argument as its option. So far, the only option hexo-yam supported is compression level which takes the value from 1 to 11. One example of invalid argument is to pass non-numeric (e.g. a string) as compression level, but I have a type checking on that which makes it default to 11 if the value is not a number. Another alternative is to use out-of-range level like 9000, but it still doesn’t crash even when I put negative number (it does crash <code>zlib.gzip</code> though). Another approach is to pass non-string as input, but that crashes hexo’s router instead of brotli.</p></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Last Updated:</span> <time class="dt-updated" datetime="2020-09-28T00:00:00.000Z" itemprop="dateModified">28 Sep 2020</time></li><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2019-12-30T00:00:00.000Z" itemprop="datePublished">30 <a href="/blog/2019/12/" title="See December 2019's posts">Dec</a> <a href="/blog/2019/" title="See 2019's posts">2019</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">Javascript</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/unit-testing-jest.md" rel="noopener external nofollow noreferrer">unit-testing-jest.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2020/01/20/how-to-use-camaro-xml/"><div class="article-nav-title">How to use Camaro to parse XML to JSON</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2019/12/08/github-referer-firefox/"><div class="article-nav-title">GitHub now requires web browser to send referer</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>