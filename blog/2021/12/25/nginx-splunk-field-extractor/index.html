<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Parsing NGINX log in Splunk | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2021/12/25/nginx-splunk-field-extractor/"><meta name="description" content="Configure regex in field extractor to create relevant fields"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="splunk"><meta property="article:tag" content="nginx"><meta property="og:type" content="article"><meta property="og:title" content="Parsing NGINX log in Splunk"><meta property="og:url" content="https://mdleom.com/blog/2021/12/25/nginx-splunk-field-extractor/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="Configure regex in field extractor to create relevant fields"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2021/12/25/nginx-splunk-field-extractor/"><meta property="article:published_time" content="2021-12-25T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-nginx-splunk-field-extractor" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Parsing NGINX log in Splunk <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">Configure regex in field extractor to create relevant fields</p><div class="e-content article-entry" itemprop="articleBody"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-request"><span class="toc-text">Web request</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Regex"><span class="toc-text">Regex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event"><span class="toc-text">Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fields"><span class="toc-text">Fields</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-request"><span class="toc-text">Proxy request</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Regex-1"><span class="toc-text">Regex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-1"><span class="toc-text">Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fields-1"><span class="toc-text">Fields</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upstream-error-response"><span class="toc-text">Upstream error response</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Regex-2"><span class="toc-text">Regex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-2"><span class="toc-text">Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fields-2"><span class="toc-text">Fields</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upstream-epoll-error"><span class="toc-text">Upstream epoll error</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Regex-3"><span class="toc-text">Regex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-3"><span class="toc-text">Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fields-3"><span class="toc-text">Fields</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upstream-epoll-error-with-referrer"><span class="toc-text">Upstream epoll error with referrer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Regex-4"><span class="toc-text">Regex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-4"><span class="toc-text">Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fields-4"><span class="toc-text">Fields</span></a></li></ol></li></ol><p>For web server’s access log, Splunk has built-in support for Apache only. Splunk has a feature called field extractor. It is powered by delimiter and regex, and enables user to add new <a href="https://docs.splunk.com/Documentation/Splunk/8.2.3/Knowledge/Aboutfields" rel="noopener external nofollow noreferrer"><em>fields</em></a> to be used in a search query. This post will only covers the regex patterns to parse nginx log, for instruction on field extractor, I recommend perusing the <a href="https://docs.splunk.com/Documentation/Splunk/8.2.3/Knowledge/ExtractfieldsinteractivelywithIFX" rel="noopener external nofollow noreferrer">official documentation</a>.</p><p>To illustrate, say we have a log format like this:</p><pre><code class="hljs plaintext">&#123;id&#125; &quot;&#123;http.request.host&#125;&quot; &quot;&#123;http.request.header.user-agent&#125;&quot;</code><button class="copy-button">Copy</button></pre><p>An example log is:</p><pre><code class="hljs plaintext">123 &quot;example.com&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/95.0&quot;</code><button class="copy-button">Copy</button></pre><p>While you could search for a specific keyword, e.g. attempts of <a href="/blog/2021/12/17/log4shell-log4j-unbound-dns/" title="Check Log4Shell vulnerability using Unbound DNS server">Log4shell exploit</a>, since there are no fields, you cannot run any statistics like <a href="https://docs.splunk.com/Documentation/Splunk/latest/SearchReference/Table" rel="noopener external nofollow noreferrer"><code>table</code></a> or <a href="https://docs.splunk.com/Documentation/Splunk/latest/SearchReference/stats" rel="noopener external nofollow noreferrer"><code>stats</code></a> on the search results.</p><p>Splunk is able to understand Apache log format because its field extractor already includes the necessary regex patterns to parse the relevant fields of each line in a log. Choosing a source type is equivalent of choosing a log format. If a format is not listed in <a href="https://docs.splunk.com/Documentation/Splunk/8.2.3/Data/Listofpretrainedsourcetypes" rel="noopener external nofollow noreferrer">the default list</a>, we can either use an add-on or create new fields using field extractor. There is a Splunk <a href="https://docs.splunk.com/Documentation/AddOns/latest/NGINX" rel="noopener external nofollow noreferrer">add-on</a> for nginx and I suggest to try it before resorting to field extractor.</p><p>I create five patterns which cover most of the nginx events I encountered during my work. Refer to the documentation for <a href="https://docs.splunk.com/Documentation/Splunk/8.2.3/Knowledge/AboutSplunkregularexpressions" rel="noopener external nofollow noreferrer">supported syntax</a>.</p><p>A field is extracted through “capturing group”.</p><pre><code class="hljs plaintext">(?&lt;field_name&gt;capture pattern)</code><button class="copy-button">Copy</button></pre><p>For example, <code>(?&lt;month&gt;\w+)</code> searches for one or more (<code>+</code>) alphanumeric characters (<code>\w</code>) and names the field as <code>month</code>. I opted for lazier matching, mostly using unbounded quantifier <code>+</code> instead of a stricter range of occurrences <code>&#123;M,N&#125;</code> despite knowing the exact pattern of a field. I found some fields may stray off slightly from the expected pattern, so a lazier matching tends match more events without matching unwanted’s.</p><h2 id="Web-request">Web request <a href="#Web-request" class="headerlink" title="Web request">§</a></h2><h3 id="Regex">Regex <a href="#Regex" class="headerlink" title="Regex">§</a></h3><pre><code class="hljs plaintext">(?&lt;month&gt;\w+)\s+(?&lt;day&gt;\d+)\s(?&lt;time&gt;[\d\:]+)\s(?&lt;proxy_ip&gt;[\d\.]+)(?:\snginx\:\s)(?&lt;remote_ip&gt;[\d\.]+)(?:\s\d+\s\S+\s\S+\s)\[(?&lt;time_local&gt;\S+)\s(?&lt;timezone&gt;\+\d&#123;4&#125;)\]\s&quot;(?&lt;http_method&gt;\w+)\s(?&lt;http_path&gt;.+)\s(?&lt;http_version&gt;HTTP/\d\.\d)&quot;\s(?&lt;http_status&gt;\d&#123;3&#125;)\s(?:\d+)\s&quot;(?&lt;request_url&gt;.[^&quot;]*)&quot;\s&quot;(?&lt;http_user_agent&gt;.[^&quot;]*)&quot;\s(?&lt;server_ip&gt;[\d\.]+)\:(?&lt;server_port&gt;\d+)(?:\s\d+\s\d+\s)(?&lt;ssl_version&gt;\S+)\s(?&lt;ssl_cipher&gt;\S+)\s(?&lt;http_cookie&gt;\S+)</code><button class="copy-button">Copy</button></pre><h3 id="Event">Event <a href="#Event" class="headerlink" title="Event">§</a></h3><pre><code class="hljs plaintext">Dec 24 01:23:45 192.168.0.2 nginx: 1.2.3.4 55763 - - [24/Dec/2021:01:23:45 +0000] &quot;GET /page.html HTTP/2.0&quot; 200 494 &quot;https://www.example.com&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/95.0&quot; 192.168.1.2:8080 123 4 TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 abcdef .</code><button class="copy-button">Copy</button></pre><h3 id="Fields">Fields <a href="#Fields" class="headerlink" title="Fields">§</a></h3><table><thead><tr><th>Field</th><th>Value</th><th>Regex</th><th>Explanation</th></tr></thead><tbody><tr><td>month</td><td>Dec</td><td><code>(?&lt;month&gt;\w+)</code></td><td>One or more alphanumeric</td></tr><tr><td>day</td><td>24</td><td><code>(?&lt;day&gt;\d+)</code></td><td>One or more digit</td></tr><tr><td>time</td><td>01:23:45</td><td><code>(?&lt;time&gt;[\d\:]+)</code></td><td>One or more digit or semicolon</td></tr><tr><td>proxy_ip</td><td>192.168.0.2</td><td><code>(?&lt;proxy_ip&gt;[\d\.]+)</code></td><td>One or more digit or dot</td></tr><tr><td>remote_ip</td><td>1.2.3.4</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>time_local</td><td>24&#x2F;Dec&#x2F;2021:01:23:45</td><td><code>(?&lt;time_local&gt;\S+)</code></td><td>One or more non-whitespace characters</td></tr><tr><td>timezone</td><td>+0000</td><td><code>(?&lt;timezone&gt;[\+\-]\d&#123;4&#125;)</code></td><td>Four digits with plus or minus prefix</td></tr><tr><td>http_method</td><td>GET</td><td><code>(?&lt;http_method&gt;\w+)</code></td><td></td></tr><tr><td>http_path</td><td>&#x2F;page.html</td><td><code>(?&lt;http_path&gt;.+)</code></td><td>One or more of any character</td></tr><tr><td>http_version</td><td>HTTP&#x2F;2.0</td><td><code>(?&lt;http_version&gt;HTTP/\d\.\d)</code></td><td>“HTTP”, a digit, dot and digit</td></tr><tr><td>http_status</td><td>200</td><td><code>(?&lt;http_status&gt;\d&#123;3&#125;)</code></td><td>Three digits</td></tr><tr><td>request_url</td><td><a href="https://www.example.com/" rel="noopener external nofollow noreferrer">https://www.example.com</a></td><td><code>(?&lt;request_url&gt;.[^&quot;]*)</code></td><td>Zero or more of any character except double quote</td></tr><tr><td>http_user_agent</td><td>Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko&#x2F;20100101 Firefox&#x2F;95.0</td><td><code>(?&lt;http_user_agent&gt;.[^&quot;]*)</code></td><td></td></tr><tr><td>server_ip</td><td>192.168.1.2</td><td><code>(?&lt;server_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>server_port</td><td>8080</td><td><code>(?&lt;server_port&gt;\d+)</code></td><td></td></tr><tr><td>ssl_version</td><td>TLSv1.2</td><td><code>(?&lt;ssl_version&gt;\S+)</code></td><td></td></tr><tr><td>ssl_cipher</td><td>ECDHE-RSA-AES128-GCM-SHA256</td><td><code>(?&lt;ssl_cipher&gt;\S+)</code></td><td></td></tr><tr><td>http_cookie</td><td>abcdef</td><td><code>(?&lt;http_cookie&gt;\S+)</code></td><td></td></tr></tbody></table><p>nginx is configured as a reverse proxy, <code>proxy_ip</code> is its ip whereas <code>server_ip</code> is the upstream’s.</p><h2 id="Proxy-request">Proxy request <a href="#Proxy-request" class="headerlink" title="Proxy request">§</a></h2><h3 id="Regex-1">Regex <a href="#Regex-1" class="headerlink" title="Regex">§</a></h3><pre><code class="hljs plaintext">(?&lt;month&gt;\w+)\s+(?&lt;day&gt;\d+)\s(?&lt;time&gt;[\d\:]+)\s(?&lt;proxy_ip&gt;[\d\.]+)(?:\snginx\:\s)(?&lt;year&gt;\d&#123;4&#125;)\/(?&lt;nmonth&gt;\d&#123;2&#125;)(?:\/\d&#123;2&#125;\s[\d\:]+\s)\[(?&lt;log_level&gt;\w+)\](?:\s\d+#\d+\:\s\*\d+\sclient\s)(?&lt;remote_ip&gt;[\d\.]+)\:(?&lt;remote_port&gt;\d+)(?:\sconnected\sto\s)(?&lt;server_ip&gt;[\d\.]+)\:(?&lt;server_port&gt;\d+)</code><button class="copy-button">Copy</button></pre><h3 id="Event-1">Event <a href="#Event-1" class="headerlink" title="Event">§</a></h3><pre><code class="hljs plaintext">Dec 24 01:23:45 192.168.0.2 nginx: 2021/12/24 01:23:45 [info] 1776#1776:*114333142 client 1.2.3.4:19802 connected to 192.168.1.2:8080</code><button class="copy-button">Copy</button></pre><h3 id="Fields-1">Fields <a href="#Fields-1" class="headerlink" title="Fields">§</a></h3><table><thead><tr><th>Field</th><th>Value</th><th>Regex</th><th>Explanation</th></tr></thead><tbody><tr><td>month</td><td>Dec</td><td><code>(?&lt;month&gt;\w+)</code></td><td></td></tr><tr><td>day</td><td>24</td><td><code>(?&lt;day&gt;\d+)</code></td><td></td></tr><tr><td>time</td><td>01:23:45</td><td><code>(?&lt;time&gt;[\d\:]+)</code></td><td></td></tr><tr><td>proxy_ip</td><td>192.168.0.2</td><td><code>(?&lt;proxy_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>year</td><td>2021</td><td><code>(?&lt;year&gt;\d&#123;4&#125;)</code></td><td></td></tr><tr><td>nmonth</td><td>12</td><td><code>(?&lt;nmonth&gt;\d&#123;2&#125;)</code></td><td></td></tr><tr><td>log_level</td><td>info</td><td><code>(?&lt;log_level&gt;\w+)</code></td><td></td></tr><tr><td>remote_ip</td><td>1.2.3.4</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>remote_port</td><td>19802</td><td><code>(?&lt;remote_port&gt;\d+)</code></td><td></td></tr><tr><td>server_ip</td><td>192.168.1.2</td><td><code>(?&lt;server_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>server_port</td><td>8080</td><td><code>(?&lt;server_port&gt;\d+)</code></td><td></td></tr></tbody></table><h2 id="Upstream-error-response">Upstream error response <a href="#Upstream-error-response" class="headerlink" title="Upstream error response">§</a></h2><h3 id="Regex-2">Regex <a href="#Regex-2" class="headerlink" title="Regex">§</a></h3><pre><code class="hljs plaintext">(?&lt;month&gt;\w+)\s+(?&lt;day&gt;\d+)\s(?&lt;time&gt;[\d\:]+)\s(?&lt;proxy_ip&gt;[\d\.]+)(?:\snginx\:\s)(?&lt;year&gt;\d&#123;4&#125;)\/(?&lt;nmonth&gt;\d&#123;2&#125;)(?:\/\d&#123;2&#125;\s[\d\:]+\s)\[(?&lt;log_level&gt;\w+)\](?:\s\d+#\d+\:\s\*\d+\s)(?&lt;upstream_error&gt;.[^,]*)(?:,\sclient\:\s)(?&lt;remote_ip&gt;[\d\.]+)(?:,\sserver\:\s)(?&lt;server_host&gt;.[^,]*)(?:,\srequest\:\s&quot;)(?&lt;http_method&gt;\w+)\s(?&lt;http_path&gt;\S+)\s(?&lt;http_version&gt;HTTP/\d\.\d)(?:&quot;,\supstream\:\s&quot;)(?&lt;upstream_url&gt;.[^&quot;]*)&quot;,\shost\:\s&quot;(?&lt;upstream_host&gt;.[^&quot;]*)</code><button class="copy-button">Copy</button></pre><h3 id="Event-2">Event <a href="#Event-2" class="headerlink" title="Event">§</a></h3><pre><code class="hljs plaintext">Dec 24 01:23:45 192.168.0.2 nginx: 2021/12/24 01:23:45 [error] 1776#1776:*71197740 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 1.2.3.4, server: example.com, request: &quot;POST /api/path HTTP/2.0&quot;,upstream: &quot;http://192.168.1.2:8080/api/path&quot;, host:&quot;example.com&quot;</code><button class="copy-button">Copy</button></pre><h3 id="Fields-2">Fields <a href="#Fields-2" class="headerlink" title="Fields">§</a></h3><table><thead><tr><th>Field</th><th>Value</th><th>Regex</th><th>Explanation</th></tr></thead><tbody><tr><td>month</td><td>Dec</td><td><code>(?&lt;month&gt;\w+)</code></td><td></td></tr><tr><td>day</td><td>24</td><td><code>(?&lt;day&gt;\d+)</code></td><td></td></tr><tr><td>time</td><td>01:23:45</td><td><code>(?&lt;time&gt;[\d\:]+)</code></td><td></td></tr><tr><td>proxy_ip</td><td>192.168.0.2</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>year</td><td>2021</td><td><code>(?&lt;year&gt;\d&#123;4&#125;)</code></td><td></td></tr><tr><td>nmonth</td><td>12</td><td><code>(?&lt;nmonth&gt;\d&#123;2&#125;)</code></td><td></td></tr><tr><td>log_level</td><td>error</td><td><code>(?&lt;log_level&gt;\w+)</code></td><td></td></tr><tr><td>upstream_error</td><td>upstream timed out (110: Connection timed out) while reading response header from upstream</td><td><code>(?&lt;upstream_error&gt;.[^,]*)</code></td><td>Zero or more of any character except comma</td></tr><tr><td>remote_ip</td><td>1.2.3.4</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>server_host</td><td>example.com</td><td><code>(?&lt;server_host&gt;.[^,]*)</code></td><td></td></tr><tr><td>http_method</td><td>POST</td><td><code>(?&lt;http_method&gt;\w+)</code></td><td></td></tr><tr><td>http_path</td><td>&#x2F;api&#x2F;path</td><td><code>(?&lt;http_path&gt;\S+)</code></td><td></td></tr><tr><td>http_version</td><td>HTTP&#x2F;2.0</td><td><code>(?&lt;http_version&gt;HTTP/\d\.\d)</code></td><td></td></tr><tr><td>upstream_url</td><td><a href="http://192.168.1.2:8080/api/path" rel="noopener external nofollow noreferrer">http://192.168.1.2:8080/api/path</a></td><td><code>(?&lt;upstream_url&gt;.[^&quot;]*)</code></td><td></td></tr><tr><td>upstream_host</td><td>example.com</td><td><code>(?&lt;upstream_host&gt;.[^&quot;]*)</code></td><td></td></tr></tbody></table><h2 id="Upstream-epoll-error">Upstream epoll error <a href="#Upstream-epoll-error" class="headerlink" title="Upstream epoll error">§</a></h2><h3 id="Regex-3">Regex <a href="#Regex-3" class="headerlink" title="Regex">§</a></h3><pre><code class="hljs plaintext">(?&lt;month&gt;\w+)\s+(?&lt;day&gt;\d+)\s(?&lt;time&gt;[\d\:]+)\s(?&lt;proxy_ip&gt;[\d\.]+)(?:\snginx\:\s)(?&lt;year&gt;\d&#123;4&#125;)\/(?&lt;nmonth&gt;\d&#123;2&#125;)(?:\/\d&#123;2&#125;\s[\d\:]+\s)\[(?&lt;log_level&gt;\w+)\](?:\s\d+#\d+\:\s\*\d+\s)(?&lt;upstream_error&gt;[^,]*,[^,]*)(?:,\sclient\:\s)(?&lt;remote_ip&gt;[\d\.]+)(?:,\sserver\:\s)(?&lt;server_host&gt;.[^,]*)(?:,\srequest\:\s&quot;)(?&lt;http_method&gt;\w+)\s(?&lt;http_path&gt;\S+)\s(?&lt;http_version&gt;HTTP/\d\.\d)(?:&quot;,\supstream\:\s&quot;)(?&lt;upstream_url&gt;.[^&quot;]*)(?:&quot;,\shost\:\s&quot;)(?&lt;upstream_host&gt;.[^&quot;]*)</code><button class="copy-button">Copy</button></pre><h3 id="Event-3">Event <a href="#Event-3" class="headerlink" title="Event">§</a></h3><pre><code class="hljs plaintext">Dec 24 01:23:45 192.168.0.2 nginx: 2021/12/24 01:23:45 [info] 13199#13199: *81574833 epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while connecting to upstream, client: 1.2.3.4, server: example.com, request: &quot;GET /page.html HTTP/1.1&quot;, upstream:&quot;http://192.168.1.2/page.html&quot;, host: &quot;example.com&quot;</code><button class="copy-button">Copy</button></pre><h3 id="Fields-3">Fields <a href="#Fields-3" class="headerlink" title="Fields">§</a></h3><table><thead><tr><th>Field</th><th>Value</th><th>Regex</th><th>Explanation</th></tr></thead><tbody><tr><td>month</td><td>Dec</td><td><code>(?&lt;month&gt;\w+)</code></td><td></td></tr><tr><td>day</td><td>24</td><td><code>(?&lt;day&gt;\d+)</code></td><td></td></tr><tr><td>time</td><td>01:23:45</td><td><code>(?&lt;time&gt;[\d\:]+)</code></td><td></td></tr><tr><td>proxy_ip</td><td>192.168.0.2</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>year</td><td>2021</td><td><code>(?&lt;year&gt;\d&#123;4&#125;)</code></td><td></td></tr><tr><td>nmonth</td><td>12</td><td><code>(?&lt;nmonth&gt;\d&#123;2&#125;)</code></td><td></td></tr><tr><td>log_level</td><td>info</td><td><code>(?&lt;log_level&gt;\w+)</code></td><td></td></tr><tr><td>upstream_error</td><td>epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while connecting to upstream</td><td><code>(?&lt;upstream_error&gt;.[^,]*)</code></td><td></td></tr><tr><td>remote_ip</td><td>1.2.3.4</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>server_host</td><td>example.com</td><td><code>(?&lt;server_host&gt;.[^,]*)</code></td><td></td></tr><tr><td>http_method</td><td>GET</td><td><code>(?&lt;http_method&gt;\w+)</code></td><td></td></tr><tr><td>http_path</td><td>&#x2F;page.html</td><td><code>(?&lt;http_path&gt;\S+)</code></td><td></td></tr><tr><td>http_version</td><td>HTTP&#x2F;1.1</td><td><code>(?&lt;http_version&gt;HTTP/\d\.\d)</code></td><td></td></tr><tr><td>upstream_url</td><td><a href="http://192.168.1.2/page.html" rel="noopener external nofollow noreferrer">http://192.168.1.2/page.html</a></td><td><code>(?&lt;upstream_url&gt;.[^&quot;]*)</code></td><td></td></tr><tr><td>upstream_host</td><td>example.com</td><td><code>(?&lt;upstream_host&gt;.[^&quot;]*)</code></td><td></td></tr></tbody></table><h2 id="Upstream-epoll-error-with-referrer">Upstream epoll error with referrer <a href="#Upstream-epoll-error-with-referrer" class="headerlink" title="Upstream epoll error with referrer">§</a></h2><h3 id="Regex-4">Regex <a href="#Regex-4" class="headerlink" title="Regex">§</a></h3><pre><code class="hljs plaintext">(?&lt;month&gt;\w+)\s+(?&lt;day&gt;\d+)\s(?&lt;time&gt;[\d\:]+)\s(?&lt;proxy_ip&gt;[\d\.]+)(?:\snginx\:\s)(?&lt;year&gt;\d&#123;4&#125;)\/(?&lt;nmonth&gt;\d&#123;2&#125;)(?:\/\d&#123;2&#125;\s[\d\:]+\s)\[(?&lt;log_level&gt;\w+)\](?:\s\d+#\d+\:\s\*\d+\s)(?&lt;upstream_error&gt;[^,]*,[^,]*)(?:,\sclient\:\s)(?&lt;remote_ip&gt;[\d\.]+)(?:,\sserver\:\s)(?&lt;server_host&gt;.[^,]*)(?:,\srequest\:\s&quot;)(?&lt;http_method&gt;\w+)\s(?&lt;http_path&gt;\S+)\s(?&lt;http_version&gt;HTTP/\d\.\d)(?:&quot;,\supstream\:\s&quot;)(?&lt;upstream_url&gt;.[^&quot;]*)(?:&quot;,\shost\:\s&quot;)(?&lt;upstream_host&gt;.[^&quot;]*)(?:&quot;,\sreferrer\:\s&quot;)(?&lt;referrer&gt;.[^&quot;]*)</code><button class="copy-button">Copy</button></pre><h3 id="Event-4">Event <a href="#Event-4" class="headerlink" title="Event">§</a></h3><pre><code class="hljs plaintext">Dec 24 01:23:45 192.168.0.2 nginx: 2021/12/24 01:23:45 [info] 1776#1776:*71220252 epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while sending request to upstream, client: 1.2.3.4, server: example.com, request: &quot;GET /page.html HTTP/1.1&quot;, upstream: &quot;http://192.168.1.2:8080/page.html&quot;, host: &quot;example.com&quot;, referrer: &quot;https://example.com&quot;</code><button class="copy-button">Copy</button></pre><h3 id="Fields-4">Fields <a href="#Fields-4" class="headerlink" title="Fields">§</a></h3><table><thead><tr><th>Field</th><th>Value</th><th>Regex</th><th>Explanation</th></tr></thead><tbody><tr><td>month</td><td>Dec</td><td><code>(?&lt;month&gt;\w+)</code></td><td></td></tr><tr><td>day</td><td>24</td><td><code>(?&lt;day&gt;\d+)</code></td><td></td></tr><tr><td>time</td><td>01:23:45</td><td><code>(?&lt;time&gt;[\d\:]+)</code></td><td></td></tr><tr><td>proxy_ip</td><td>192.168.0.2</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>year</td><td>2021</td><td><code>(?&lt;year&gt;\d&#123;4&#125;)</code></td><td></td></tr><tr><td>nmonth</td><td>12</td><td><code>(?&lt;nmonth&gt;\d&#123;2&#125;)</code></td><td></td></tr><tr><td>log_level</td><td>info</td><td><code>(?&lt;log_level&gt;\w+)</code></td><td></td></tr><tr><td>upstream_error</td><td>epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while sending request to upstream</td><td><code>(?&lt;upstream_error&gt;.[^,]*)</code></td><td></td></tr><tr><td>remote_ip</td><td>1.2.3.4</td><td><code>(?&lt;remote_ip&gt;[\d\.]+)</code></td><td></td></tr><tr><td>server_host</td><td>example.com</td><td><code>(?&lt;server_host&gt;.[^,]*)</code></td><td></td></tr><tr><td>http_method</td><td>GET</td><td><code>(?&lt;http_method&gt;\w+)</code></td><td></td></tr><tr><td>http_path</td><td>&#x2F;page.html</td><td><code>(?&lt;http_path&gt;\S+)</code></td><td></td></tr><tr><td>http_version</td><td>HTTP&#x2F;1.1</td><td><code>(?&lt;http_version&gt;HTTP/\d\.\d)</code></td><td></td></tr><tr><td>upstream_url</td><td><a href="http://192.168.1.2:8080/page.html" rel="noopener external nofollow noreferrer">http://192.168.1.2:8080/page.html</a></td><td><code>(?&lt;upstream_url&gt;.[^&quot;]*)</code></td><td></td></tr><tr><td>upstream_host</td><td>example.com</td><td><code>(?&lt;upstream_host&gt;.[^&quot;]*)</code></td><td></td></tr><tr><td>referrer</td><td><a href="https://example.com/" rel="noopener external nofollow noreferrer">https://example.com</a></td><td><code>(?&lt;referrer&gt;.[^&quot;]*)</code></td><td></td></tr></tbody></table></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2021-12-25T00:00:00.000Z" itemprop="datePublished">25 <a href="/blog/2021/12/" title="See December 2021's posts">Dec</a> <a href="/blog/2021/" title="See 2021's posts">2021</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/splunk/" rel="tag">Splunk</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/nginx-splunk-field-extractor.md" rel="noopener external nofollow noreferrer">nginx-splunk-field-extractor.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2021/12/27/caddy-plugins-nixos/"><div class="article-nav-title">Installing Caddy plugins in NixOS</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2021/12/17/log4shell-log4j-unbound-dns/"><div class="article-nav-title">Check Log4Shell vulnerability using Unbound DNS server</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>