<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Separate Python libraries with venv | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2021/04/20/python-venv/"><meta name="description" content="Easier removal of unneeded dependencies"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="linux"><meta property="og:type" content="article"><meta property="og:title" content="Separate Python libraries with venv"><meta property="og:url" content="https://mdleom.com/blog/2021/04/20/python-venv/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="Easier removal of unneeded dependencies"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2021/04/20/python-venv/"><meta property="article:published_time" content="2021-04-20T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-python-venv" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Separate Python libraries with venv <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">Easier removal of unneeded dependencies</p><div class="e-content article-entry" itemprop="articleBody"><p>I have several Python scripts for data processing purpose. I put them in “<del>&#x2F;.local&#x2F;bin&#x2F;“ folder so that I can directly run them by <code>$ script_a</code> (“</del>&#x2F;.local&#x2F;bin&#x2F;“ is preconfigured to be part of “$PATH”). A minor annoyance I found is that whenever I want to dispose a script along with its dependencies, I need to figure out which ones are core libraries or which ones are still required by other scripts (e.g. is <a href="https://pypi.org/project/logging/" rel="noopener external nofollow noreferrer"><code>logging</code></a> a <a href="https://docs.python.org/3/library/logging.html" rel="noopener external nofollow noreferrer">core</a> library?).</p><p>Recently, I learned about <a href="https://docs.python.org/3/library/venv.html" rel="noopener external nofollow noreferrer">venv</a> from awscli which it uses to install dependencies in a dedicated folder. Despite a plenty of tutorials on virtual environment, I found most of them use virtualenv since it’s more powerful and supports Python2; I prefer venv because it is a core Python3 library and sufficient for my need.</p><p>Let’s say I have <code>script_a.py</code> and it requires <code>dep_x</code> and <code>dep_y</code> libraries. I install the libraries to “<del>&#x2F;.local&#x2F;lib&#x2F;script_a&#x2F;“ folder, so if I don’t need the script anymore, I just “rm -rf” the script and “</del>&#x2F;.local&#x2F;lib&#x2F;script_a&#x2F;“ folder where its dependencies are located.</p><pre><code class="hljs plaintext">mkdir -p ~/.local/lib/
python -m venv ~/.local/lib/script_a/
source ~/.local/lib/script_a/bin/activate
pip install dep_x dep_y
deactivate</code><button class="copy-button">Copy</button></pre><p>When you run <code>pip list</code>, you won’t see the libraries because they are installed in a separate folder. To inspect them,</p><pre><code class="hljs plaintext">source ~/.local/lib/script_a/bin/activate
pip list
deactivate</code><button class="copy-button">Copy</button></pre><p>Now you should be able to see them.</p><p>In the Python script, in order to use the libraries, you should use the usual <code>#!/usr/bin/env python3</code> header, instead it should be <code>#!/home/foo/.local/lib/script_a/bin/python3</code>.</p><p>If the script is intended to be installed among users, you can use the following shell script to install the python script:</p><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/bin/&quot;</span>
<span class="hljs-built_in">cp</span> <span class="hljs-string">&quot;script_a.py&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/bin/script_a&quot;</span>
<span class="hljs-built_in">chmod</span> u+x <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/bin/script_a&quot;</span>
sed <span class="hljs-string">&quot;1 s|^.*$|#\!<span class="hljs-variable">$HOME</span>/.local/lib/script_a/bin/python3|&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/bin/script_a&quot;</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/lib/&quot;</span>
python -m venv <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/lib/script_a/&quot;</span>
. <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.local/lib/script_a/bin/activate&quot;</span>
pip install dep_x dep_y
deactivate</code><button class="copy-button">Copy</button></pre><p>Although slash (&#x2F;) is usually used as a separator in sed, but it actually supports other special characters. In this example, I use vertical bar (|) so that I don’t have to escape the slashes. Notice the shell script is a <em>posix</em> shell script, so <code>. &quot;$HOME/...&quot;</code> is used instead of <code>source &quot;$HOME/...&quot;</code>.</p><p>Depending on python is installed, you may be need to substitute “python” and “pip” with “python3” and “pip3” respectively. Some installations like Ubuntu WSL may not include “venv” library, it can installed with <code>python3-venv</code> package.</p></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2021-04-20T00:00:00.000Z" itemprop="datePublished">20 <a href="/blog/2021/04/" title="See April 2021's posts">Apr</a> <a href="/blog/2021/" title="See 2021's posts">2021</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">Linux</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/python-venv.md" rel="noopener external nofollow noreferrer">python-venv.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2021/06/13/upgrade-note-nixos-21-05/"><div class="article-nav-title">My upgrade note of NixOS 21.05</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2021/03/20/urlhaus-phishing-snort-suricata/"><div class="article-nav-title">urlhaus-filter and phishing-filter available as Snort and Suricata rules</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>