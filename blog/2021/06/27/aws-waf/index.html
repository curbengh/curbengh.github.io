<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Convert AWS WAF ACLs to human-readable format | Ming Di Leom&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mdleom.com/blog/2021/06/27/aws-waf/"><meta name="description" content="Run the attached script to download and convert ACLs"><meta property="article:author" content="Ming Di Leom"><meta property="article:tag" content="aws"><meta property="article:tag" content="security"><meta property="og:type" content="article"><meta property="og:title" content="Convert AWS WAF ACLs to human-readable format"><meta property="og:url" content="https://mdleom.com/blog/2021/06/27/aws-waf/"><meta property="og:site_name" content="Ming Di Leom&#39;s Blog"><meta property="og:description" content="Run the attached script to download and convert ACLs"><meta property="og:locale" content="en_GB"><meta property="og:image" content="https://mdleom.com/screenshot/blog/2021/06/27/aws-waf/"><meta property="article:published_time" content="2021-06-27T00:00:00.000Z"><meta property="article:modified_time" content="2021-09-01T00:00:00.000Z"><link rel="alternate" href="/atom.xml" title="Ming Di Leom's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/svg/favicon.svg" type="image/svg+xml" sizes="any"><link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="stylesheet" href="/css/chameleon.css"><meta name="yandex-verification" content="e026a03a5dd06730"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="container" class="container"><article id="post-aws-waf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><header id="header" class="header"><nav class="main-nav"><a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/blog/">Blog</a> <a class="main-nav-link" href="/about/">About</a> <a class="main-nav-link" href="/atom.xml">Feed</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a><div class="search-container"><form id="searchForm" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click"><img src="/svg/search.svg"></a></form></div></nav><nav class="mobile-nav"><a class="site-title" href="/">mdleom.com</a><ul class="mobile-nav-menu"><label for="mobile-menu-toggle"><a class="no-underline" id="menu-button">&#9776;</a></label> <input id="mobile-menu-toggle" type="checkbox"><ul id="mobile-nav-link"><div class="search-container"><form id="searchFormMob" method="post" action="https://duckduckgo.com/" rel="noopener external nofollow noreferrer" role="search"><input type="search" name="q" class="search-box" placeholder="Search..." title="Powered by DuckDuckGo" enterkeyhint="search"> <input type="hidden" name="sites" value="mdleom.com"> <input type="hidden" name="kd" value="-1"> <input type="hidden" name="kg" value="p"> <input type="hidden" name="kae" value="#000"> <a class="search-button" id="search-click-mobile"><img src="/svg/search.svg"></a></form></div><i>Powered by DuckDuckGo</i> <a class="mobile-nav-link-a" href="/">Home</a> <a class="mobile-nav-link-a" href="/blog/">Blog</a> <a class="mobile-nav-link-a" href="/about/">About</a> <a class="mobile-nav-link-a" href="/atom.xml">Feed</a> <a class="mobile-nav-link-a" href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">GitLab</a></ul></ul></nav></header><hr class="header-hr"><div class="article-inner"><header class="article-header"><h1 class="p-name entry-title article-title" itemprop="headline name">Convert AWS WAF ACLs to human-readable format <a id="btnshare"><img src="/svg/share.svg"></a></h1></header><p class="p-summary">Run the attached script to download and convert ACLs</p><div class="e-content article-entry" itemprop="articleBody"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ACL-schema"><span class="toc-text">ACL schema</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Converted-schema"><span class="toc-text">Converted schema</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#And-x2F-OrStatement"><span class="toc-text">And&#x2F;OrStatement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nested-And-x2F-OrStatement"><span class="toc-text">Nested And&#x2F;OrStatement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NotStatement"><span class="toc-text">NotStatement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#String-match"><span class="toc-text">String match</span></a></li></ol><p>I regularly need to audit my company’s access control lists (ACLs) implemented in <a href="https://aws.amazon.com/waf/" rel="noopener external nofollow noreferrer">AWS WAF</a>, as part of my job. Each ACL can be more than a thousand lines which is practically impossible to read. I wrote a script that downloads and summarises the ACLs into human-readable format; each one-thousand-line behemoth is transformed into a fifty-line summary that I can <em>actually</em> audit.</p><p>The script is <a href="https://gitlab.com/curben/aws-scripts/-/blob/main/waf-acl.py" rel="noopener external nofollow noreferrer">available here</a>. It currently only supports Cloudfront ACL, feel free to extend it to support regional ACL.</p><p>(Edit: 1 Sep 2021) regional ACL is now supported.</p><h2 id="ACL-schema">ACL schema <a href="#ACL-schema" class="headerlink" title="ACL schema">§</a></h2><p>The underlying format of a web ACL is JSON. In this use case, I’m only concern with two keys:</p><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;Rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;Action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">&quot;Block&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
      <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;Action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">&quot;Allow&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
      <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><p>The script names each ACL according to the value of “Name”. “Rules” is an array of objects, where each object represents a rule. Each rule has an <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-action.html" rel="noopener external nofollow noreferrer">action</a> of count, allow or block.</p><p>In each rule, there is a statement and it functions as a matching condition. Each <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statements-list.html" rel="noopener external nofollow noreferrer">statement</a> can contain one or match statements combined using logical rule (AND, NOT, OR).</p><h2 id="Converted-schema">Converted schema <a href="#Converted-schema" class="headerlink" title="Converted schema">§</a></h2><p>A converted ACL has an array of objects, each object has three keys.</p><pre><code class="hljs json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;Action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;Rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span>
  <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">]</span></code><button class="copy-button">Copy</button></pre><h2 id="And-x2F-OrStatement">And&#x2F;OrStatement <a href="#And-x2F-OrStatement" class="headerlink" title="And&#x2F;OrStatement">§</a></h2><pre><div class="caption"><span>Original</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ruleA&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">&quot;OrStatement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">&quot;Statements&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
          <span class="hljs-attr">&quot;foo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span>
          <span class="hljs-attr">&quot;bar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
        <span class="hljs-punctuation">&#125;</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
  <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><pre><div class="caption"><span>Converted</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;ruleA&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;foo OR bar&quot;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><h2 id="Nested-And-x2F-OrStatement">Nested And&#x2F;OrStatement <a href="#Nested-And-x2F-OrStatement" class="headerlink" title="Nested And&#x2F;OrStatement">§</a></h2><pre><div class="caption"><span>Original</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ruleA&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">&quot;AndStatement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">&quot;Statements&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
          <span class="hljs-attr">&quot;OrStatement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">&quot;Statements&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
              <span class="hljs-punctuation">&#123;</span>
                <span class="hljs-attr">&quot;foo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
              <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
              <span class="hljs-punctuation">&#123;</span>
                <span class="hljs-attr">&quot;bar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
              <span class="hljs-punctuation">&#125;</span>
            <span class="hljs-punctuation">]</span>
          <span class="hljs-punctuation">&#125;</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span>
          <span class="hljs-attr">&quot;baz&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
        <span class="hljs-punctuation">&#125;</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
  <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><pre><div class="caption"><span>Converted</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;ruleA&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;(foo OR bar) AND baz&quot;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><h2 id="NotStatement">NotStatement <a href="#NotStatement" class="headerlink" title="NotStatement">§</a></h2><pre><div class="caption"><span>Original</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ruleA&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">&quot;NotStatement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">&quot;foo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
      <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
  <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><pre><div class="caption"><span>Converted</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;ruleA&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NOT foo&quot;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><h2 id="String-match">String match <a href="#String-match" class="headerlink" title="String match">§</a></h2><pre><div class="caption"><span>Orignal</span></div><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;ByteMatchStatement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">&quot;SearchString&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.conf&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;FieldToMatch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">&quot;UriPath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;PositionalConstraint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ENDS_WITH&quot;</span>
  <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span></code><button class="copy-button">Copy</button></pre><pre><div class="caption"><span>Converted</span></div><code class="hljs plain">UriPath=ENDSWITH(.conf)</code><button class="copy-button">Copy</button></pre></div><footer class="article-footer"><ul class="article-meta"><li><span class="label">Last Updated:</span> <time class="dt-updated" datetime="2021-09-01T00:00:00.000Z" itemprop="dateModified">1 Sep 2021</time></li><li><span class="label">Published Date:</span> <time class="dt-published" datetime="2021-06-27T00:00:00.000Z" itemprop="datePublished">27 <a href="/blog/2021/06/" title="See June 2021's posts">Jun</a> <a href="/blog/2021/" title="See 2021's posts">2021</a></time></li><li><span class="label">Tag:</span><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws/" rel="tag">Aws</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/" rel="tag">Security</a></li></ul></li><li><span class="label">Source:</span> <a href="https://gitlab.com/curben/blog/-/blob/master/source/_posts/aws-waf.md" rel="noopener external nofollow noreferrer">aws-waf.md</a></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"><span class="article-nav-link-wrap newer"><strong>Newer</strong> <a href="/blog/2021/07/02/custom-package-nixos-module/"><div class="article-nav-title">Using custom package in a NixOS module</div></a></span><span class="article-nav-link-wrap older"><strong>Older</strong> <a href="/blog/2021/06/15/cloudflare-argo-nixos/"><div class="article-nav-title">Setup Cloudflare Argo Tunnel in NixOS</div></a></span></nav></article></div><footer id="footer" class="post-footer footer"><hr><div id="copyright" class="copyright">&copy; 2018-2024 Ming Di Leom. <a href="https://gitlab.com/curben/blog" rel="noopener external nofollow noreferrer">Powered by </a><a href="https://hexo.io/" rel="noopener external nofollow noreferrer">Hexo</a> with <a href="https://gitlab.com/curben/blog/tree/master/themes/chameleon" rel="noopener external nofollow noreferrer">Chameleon</a> theme.<br>Content is available under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener external nofollow noreferrer license" itemprop="license">CC-BY-SA 4.0</a>, unless indicated otherwise.<br><a class="main-nav-link" href="/disclaimer/">Disclaimer</a> <a class="main-nav-link" href="https://stats.uptimerobot.com/1394zup2LQ" rel="noopener external nofollow noreferrer">Status</a> <a class="main-nav-link" href="https://xw226dvxac7jzcpsf4xb64r4epr6o5hgn46dxlqk7gnjptakik6xnzqd.onion/" rel="noopener external nofollow noreferrer">Onion</a> <a class="main-nav-link" href="https://gitlab.com/curben/blog#mirrors" rel="noopener external nofollow noreferrer">Eepsite</a></div></footer><script src="/libs/clipboard-2.0.6.min.js" defer></script><script src="/js/copy-button.js"></script><script src="/js/chameleon.js"></script></body></html>